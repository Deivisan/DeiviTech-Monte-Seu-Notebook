<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeiviTech: Notebooks Personalizados (v3 - Merged Beta)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --color-bg-main-start: #073B4C; 
            --color-bg-main-end: #0B4F6C;
            --color-text-main: #F0F4F8;
            --color-text-card: #073B4C;
            --color-card-bg: #FFFFFF;
            --color-card-bg-alt: #F8F9FA; 
            --color-card-border: #D1E0E0; 
            --color-primary: #118AB2;
            --color-primary-hover: #0E6A8A;
            --color-primary-light: #E0F7FA;
            --color-secondary: #06D6A0;
            --color-secondary-hover: #05A980;
            --color-secondary-text: #073B4C;
            --color-accent-yellow: #FFD166;
            --color-accent-red: #FF6B6B;
            --color-accent-red-hover: #E05050;
            --color-border-subtle: rgba(17, 138, 178, 0.2);
            --color-selected-bg: var(--color-primary);
            --color-selected-text: #FFFFFF;
            --color-selected-border: var(--color-primary);
            --color-disabled-bg: #F1F3F5;
            --color-disabled-text: #AEB6BF;
            --color-disabled-border: #E0E0E0;
            --shadow-card: 0 8px 12px -4px rgba(0, 0, 0, 0.06), 0 3px 5px -3px rgba(0, 0, 0, 0.08);
            --shadow-card-hover: 0 15px 20px -5px rgba(0, 0, 0, 0.08), 0 6px 8px -5px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --color-bg-main-start: #0A192F; 
            --color-bg-main-end: #132F4C;
            --color-text-main: #CCD6F6;
            --color-text-card: #E0F7FA; 
            --color-card-bg: #112240; 
            --color-card-bg-alt: #0A192F; 
            --color-card-border: #233554; 
            --color-border-subtle: rgba(100, 255, 218, 0.1); 
            --color-primary: #64FFDA; 
            --color-primary-hover: #52D0B8;
            --color-primary-light: #1A3A5A; 
            --color-secondary: #FFD166; 
            --color-secondary-text: #0A192F; 
            --color-disabled-bg: #1A2A47;
            --color-disabled-text: #5A6B8C;
            --color-disabled-border: #2A3A5A;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--color-bg-main-start) 0%, var(--color-bg-main-end) 100%);
            color: var(--color-text-main);
            scroll-behavior: smooth;
            animation: gradientAnimation 20s ease infinite alternate;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .beta-watermark {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background-color: rgba(255, 209, 102, 0.85);
            color: var(--color-text-card);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            z-index: 1000;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        h1 { color: var(--color-secondary); }
        h2, h3 { color: var(--color-primary); }
        h2 .section-icon, h3 .section-icon {
            margin-right: 0.75rem;
            font-size: 1.3em; 
            color: var(--color-secondary);
            vertical-align: middle;
        }
        body.dark-mode h2 .section-icon, body.dark-mode h3 .section-icon {
             color: var(--color-primary); /* Primary becomes the accent icon color in dark for titles */
        }
        body.dark-mode .option-item .section-icon, body.dark-mode .service-item .section-icon { color: var(--color-primary) !important;}


        .card {
            background-color: var(--color-card-bg);
            color: var(--color-text-card);
            border-radius: 0.85rem; 
            box-shadow: var(--shadow-card);
            padding: 1.75rem; 
            margin-bottom: 2.25rem; 
            transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.5s ease-out, background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
            opacity: 0;
            transform: translateY(25px);
            border: 1px solid var(--color-card-border);
        }
        .card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-card-hover);
        }
        .card.in-view {
            opacity: 1;
            transform: translateY(0);
        }

        .option-item { 
            display: flex;
            flex-direction: column; 
            align-items: flex-start; 
            padding: 1rem; 
            border-radius: 0.6rem; 
            border: 1px solid var(--color-border-subtle);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.25s ease-in-out, background-color 0.3s ease, border-color 0.3s ease;
            background-color: var(--color-card-bg-alt); 
        }
        .option-item:hover {
            background-color: var(--color-primary-light);
            border-color: var(--color-primary);
            transform: scale(1.02); 
            box-shadow: 0 4px 10px rgba(17, 138, 178, 0.15);
        }
        body.dark-mode .option-item:hover {
            box-shadow: 0 4px 10px rgba(100, 255, 218, 0.15); /* Adjust shadow for dark primary */
        }
        .option-item.selected {
            background-color: var(--color-selected-bg);
            border-color: var(--color-selected-border);
            box-shadow: 0 0 12px rgba(17, 138, 178, 0.6);
            transform: scale(1.01);
        }
        body.dark-mode .option-item.selected {
             box-shadow: 0 0 12px rgba(100, 255, 218, 0.6); /* Adjust shadow for dark primary */
        }
        .option-item.selected .option-content p,
        .option-item.selected .option-content .price-text,
        .option-item.selected .option-content .text-xs,
        .option-item.selected .option-content .text-name,
        .option-item.selected .option-content .text-description,
        .option-item.selected .option-content .text-details,
        .option-item.selected .option-content i { 
            color: var(--color-selected-text) !important;
        }
        body.dark-mode .option-item.selected .option-content p,
        body.dark-mode .option-item.selected .option-content .price-text,
        body.dark-mode .option-item.selected .option-content .text-xs,
        body.dark-mode .option-item.selected .option-content .text-name,
        body.dark-mode .option-item.selected .option-content .text-description,
        body.dark-mode .option-item.selected .option-content .text-details,
        body.dark-mode .option-item.selected .option-content i { 
            color: var(--color-secondary-text) !important; /* For bright primary in dark mode */
        }


        .option-item.disabled {
            background-color: var(--color-disabled-bg);
            border-color: var(--color-disabled-border);
            opacity: 0.55; 
            cursor: not-allowed;
            transform: scale(1); 
        }
        .option-item.disabled:hover {
            background-color: var(--color-disabled-bg);
            border-color: var(--color-disabled-border);
            box-shadow: none;
            transform: scale(1);
        }
        .option-item.disabled .option-content p,
        .option-item.disabled .option-content .price-text,
        .option-item.disabled .option-content .text-xs,
        .option-item.disabled .option-content i {
            color: var(--color-disabled-text) !important;
        }
        .option-content .text-name { color: var(--color-text-card); font-weight: 600; font-size: 1.05rem; }
        .option-content .text-description { color: #525252; font-size: 0.875rem; margin-top: 0.25rem; }
        body.dark-mode .option-content .text-description { color: #a8b2d1; }
        .option-content .price-text { color: var(--color-primary); font-weight: 700; font-size: 1rem; margin-top: 0.5rem; }
        .option-content .text-details { color: #555; font-size: 0.8rem; margin-top: 0.25rem; }
        body.dark-mode .option-content .text-details { color: #8892b0; }

        #performance-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 0.5rem; margin-top: 0.5rem; height: 28px; overflow: hidden; border: 1px solid #ccc; }
        body.dark-mode #performance-bar-container { background-color: #2a3a5a; border-color: #45567d; }
        #performance-bar { width: 0%; height: 100%; background-color: var(--color-secondary); text-align: center; line-height: 28px; color: var(--color-secondary-text); font-weight: bold; font-size: 0.9rem; transition: width 0.6s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.6s ease-in-out; white-space: nowrap; padding: 0 10px; }
        .performance-text { color: var(--color-text-card); font-size: 0.9rem; margin-top:0.35rem; font-weight:500; }
        .energy-tendency-text { color: var(--color-text-card); font-size: 0.85rem; margin-top:0.25rem; font-weight:500; }


        .sticky-summary { 
            position: sticky; top: 1.5rem; z-index: 10; 
            background-color: var(--color-card-bg-alt); 
            border: 2px solid var(--color-primary); 
            border-radius: 0.85rem; 
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        @media (max-width: 1023px) { .sticky-summary { position: relative; top: 0; margin-bottom: 2rem; }}
        .summary-item { display: flex; align-items: center; margin-bottom: 0.4rem; font-size: 0.9rem;}
        .summary-item i { color: var(--color-primary); margin-right: 0.6rem; width: 18px; text-align: center; }
        .summary-item-name { color: var(--color-text-card); flex-grow: 1; }
        .summary-tradein-price { color: var(--color-accent-red); font-weight: 600; }

        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(7, 59, 76, 0.9); backdrop-filter: blur(8px); justify-content: center; align-items: center; }
        body.dark-mode .modal { background-color: rgba(10, 25, 47, 0.9); }
        .modal-content { 
            background-color: var(--color-card-bg); 
            color: var(--color-text-card); 
            margin: auto; padding: 2rem 2.5rem; 
            border: 2px solid var(--color-primary); 
            border-radius: 0.85rem; width: 90%; max-width: 650px; 
            box-shadow: 0 0 30px rgba(17, 138, 178, 0.4); 
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .modal-content { box-shadow: 0 0 30px rgba(100, 255, 218, 0.4); }
        .close-button { color: var(--color-accent-red); float: right; font-size: 30px; font-weight: bold; transition: color 0.2s ease; }
        .close-button:hover, .close-button:focus { color: var(--color-accent-red-hover); text-decoration: none; cursor: pointer; }
        
        .mode-toggle-btn { background-color: transparent; color: var(--color-text-main); border: 2px solid var(--color-secondary); transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; }
        .mode-toggle-btn.active { background-color: var(--color-secondary); color: var(--color-secondary-text); box-shadow: 0 2px 8px rgba(6, 214, 160, 0.4); }
        body.dark-mode .mode-toggle-btn.active { box-shadow: 0 2px 8px rgba(var(--color-secondary), 0.4); } /* Adjust for dark mode secondary */
        .mode-toggle-btn:hover:not(.active) { background-color: rgba(6, 214, 160, 0.15); }
        body.dark-mode .mode-toggle-btn:hover:not(.active) { background-color: rgba(var(--color-secondaryRgbForAlpha), 0.15); } /* Adjust for dark mode secondary */
        /* Note: --color-secondaryRgbForAlpha would need to be defined in JS if secondary changes significantly */

        
        #quality-slider { -webkit-appearance: none; appearance: none; height: 10px; background: #ccc; outline: none; opacity: 0.9; transition: opacity .2s; border-radius: 5px; }
        body.dark-mode #quality-slider { background: #45567d; }
        #quality-slider:hover { opacity: 1; }
        #quality-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; background: var(--color-secondary); cursor: pointer; border-radius: 50%; border: 3px solid var(--color-card-bg); box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        #quality-slider::-moz-range-thumb { width: 22px; height: 22px; background: var(--color-secondary); cursor: pointer; border-radius: 50%; border: 3px solid var(--color-card-bg); box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        .quality-label-active { font-weight: bold; color: var(--color-secondary); transform: scale(1.1); }

        .btn { padding: 0.85rem 1.75rem; border-radius: 0.6rem; font-weight: 600; transition: all 0.2s ease; text-align: center; }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background-color: var(--color-primary); color: white; }
        body.dark-mode .btn-primary { color: var(--color-secondary-text); /* Ensure contrast for bright primary */}
        .btn-primary:hover { background-color: var(--color-primary-hover); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        .btn-secondary { background-color: var(--color-secondary); color: var(--color-secondary-text); }
        .btn-secondary:hover { background-color: var(--color-secondary-hover); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        .btn-danger { background-color: var(--color-accent-red); color: white; }
        .btn-danger:hover { background-color: var(--color-accent-red-hover); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        .btn-lg { padding: 1rem 2rem; font-size: 1.1rem;} /* New class for larger button */


        .file-input-styled { color: var(--color-text-card); }
        .file-input-styled::file-selector-button { background-color: var(--color-primary-light); color: var(--color-primary); border: 1px solid var(--color-primary); padding: 0.6rem 1.2rem; border-radius: 0.5rem; margin-right: 1rem; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease; font-weight: 500; }
        .file-input-styled::file-selector-button:hover { background-color: var(--color-primary); color: white; }
        body.dark-mode .file-input-styled::file-selector-button:hover { color: var(--color-secondary-text); }
        
        select.custom-select, input[type="number"].custom-input, input[type="text"].custom-input, textarea.custom-textarea {
            background-color: var(--color-card-bg-alt); color: var(--color-text-card); border: 1px solid var(--color-border-subtle);
            padding: 0.85rem; border-radius: 0.6rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        select.custom-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23118AB2'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.5em 1.5em; }
        body.dark-mode select.custom-select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%2364FFDA'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");}
        select.custom-select:focus, input.custom-input:focus, textarea.custom-textarea:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(17, 138, 178, 0.25); }
        body.dark-mode select.custom-select:focus, body.dark-mode input.custom-input:focus, body.dark-mode textarea.custom-textarea:focus { box-shadow: 0 0 0 3px rgba(100,255,218,0.25); }


        .payment-logos i { font-size: 2.5rem; margin: 0 10px; color: var(--color-text-main); opacity:0.8; transition: color 0.3s ease, opacity 0.3s ease, transform 0.3s ease; }
        .payment-logos i:hover { color: var(--color-secondary); opacity:1; transform: scale(1.1); }
        
        .contact-links a { color: var(--color-secondary); text-decoration: none; transition: color 0.2s ease; margin: 0 0.5rem; }
        .contact-links a:hover { color: var(--color-primary-light); text-decoration: underline; }
        body.dark-mode .contact-links a:hover { color: var(--color-primary); /* Dark mode primary might be brighter */}

        .checkbox-option-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--color-border-subtle);
            margin-bottom: 0.5rem;
            cursor: pointer;
            background-color: var(--color-card-bg-alt);
            transition: all 0.2s ease-in-out, background-color 0.3s ease, border-color 0.3s ease;
        }
        .checkbox-option-item:hover {
            border-color: var(--color-primary);
            background-color: var(--color-primary-light);
        }
        .checkbox-option-item input[type="checkbox"] {
            appearance: none;
            width: 1.25em;
            height: 1.25em;
            border: 2px solid var(--color-primary);
            border-radius: 0.25em;
            margin-right: 0.75em;
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .checkbox-option-item input[type="checkbox"]:checked {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
        }
        .checkbox-option-item input[type="checkbox"]:checked::before {
            content: '\\f00c'; 
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: white; /* Default checkmark color */
            font-size: 0.8em;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        body.dark-mode .checkbox-option-item input[type="checkbox"]:checked::before {
            color: var(--color-secondary-text); /* Checkmark color for dark mode bright primary */
        }

        .checkbox-option-item label { cursor: pointer; flex-grow: 1; }
        
        /* Custom checkbox style for services tab */
        .service-item input[type="checkbox"].custom-service-checkbox {
            appearance: none; width: 1.5em; height: 1.5em; border: 2px solid var(--color-primary); border-radius: 0.35em; cursor: pointer; position: relative; transition: background-color 0.2s, border-color 0.2s; flex-shrink: 0;
        }
        .service-item input[type="checkbox"].custom-service-checkbox:checked { background-color: var(--color-primary); border-color: var(--color-primary); }
        .service-item input[type="checkbox"].custom-service-checkbox:checked::before { content: '\\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 1em; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        body.dark-mode .service-item input[type="checkbox"].custom-service-checkbox:checked::before { color: var(--color-secondary-text); }


        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 600;
            cursor: pointer;
            background-color: var(--color-primary-light);
            color: var(--color-primary);
            border: 1px solid var(--color-border-subtle);
            border-bottom: none;
            margin-right: 0.25rem;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            white-space: nowrap; 
        }
        .tab-button.active {
            background-color: var(--color-primary);
            color: white; 
            border-bottom: 1px solid var(--color-primary); 
        }
        body.dark-mode .tab-button.active {
            color: var(--color-secondary-text); 
        }
        .tab-content {
            display: none;
            border: 1px solid var(--color-border-subtle);
            border-top: none; 
            padding: 1.5rem;
            border-radius: 0 0 0.5rem 0.5rem;
            background-color: var(--color-card-bg); 
            color: var(--color-text-card);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        .tab-content.active { display: block; }
        
        .login-btn-placeholder {
            background-color: transparent;
            color: var(--color-text-main);
            border: 2px solid var(--color-text-main);
            opacity: 0.7;
            cursor: help;
        }
        .tutorial-details { /* For trade-in and service details */
            background-color: var(--color-card-bg-alt);
            border: 1px solid var(--color-border-subtle);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            color: var(--color-text-card); /* Ensure text color matches */
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .service-item {
            padding: 1rem; /* More padding */
            border: 1px solid var(--color-border-subtle);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            background-color: var(--color-card-bg-alt);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .service-item h4 {
            color: var(--color-primary);
            font-weight: 600;
        }
        .service-item p {
            font-size: 0.9rem;
            color: #525252;
        }
        body.dark-mode .service-item p { color: #a8b2d1; }
        .service-item .price {
            font-weight: bold;
            color: var(--color-secondary);
            margin-top: 0.25rem;
        }
        .service-item .details-toggle { color: var(--color-primary); cursor: pointer; font-size: 0.9em; }
        .service-item .details-content { display: none; margin-top: 0.5rem; padding-left: 1rem; border-left: 2px solid var(--color-border-subtle); font-size: 0.85rem;}

        .theme-toggle-btn {
            background-color: transparent;
            color: var(--color-text-main);
            border: 2px solid var(--color-secondary);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-size: 1.25rem; 
            transition: all 0.2s ease;
        }
        .theme-toggle-btn:hover {
            background-color: rgba(var(--color-secondaryRgbForAlpha, 6, 214, 160), 0.15); /* Fallback for secondary rgb */
            box-shadow: 0 0 8px rgba(var(--color-secondaryRgbForAlpha, 6, 214, 160), 0.3);
        }
        .advanced-mode-tab { 
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 600;
            cursor: not-allowed;
            background-color: var(--color-disabled-bg);
            color: var(--color-disabled-text);
            border: 1px solid var(--color-disabled-border);
            border-bottom: none;
            margin-right: 0.25rem;
            opacity: 0.7;
        }
        .advanced-mode-tab.functional { 
             cursor: pointer;
             opacity: 1;
             background-color: var(--color-primary-light);
             color: var(--color-primary);
             border: 1px solid var(--color-border-subtle);
        }
        .advanced-mode-tab.functional.active { /* Style for active functional advanced tab */
            background-color: var(--color-primary);
            color: white;
            opacity: 1;
        }
         body.dark-mode .advanced-mode-tab.functional.active {
            color: var(--color-secondary-text);
        }

        .software-tabs-container {
            display: flex;
            border-bottom: 1px solid var(--color-border-subtle);
            margin-bottom: 1rem;
            flex-wrap: wrap; /* Allow tabs to wrap on smaller screens */
        }
        .software-tab-button {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 0.25rem;
            margin-bottom: -1px; /* Overlap bottom border */
            border-radius: 0.375rem 0.375rem 0 0;
            font-weight: 500;
            background-color: var(--color-card-bg-alt);
            color: var(--color-text-card);
            white-space: nowrap;
        }
        .software-tab-button.active {
            background-color: var(--color-primary);
            color: var(--color-selected-text);
            border-color: var(--color-border-subtle);
            border-bottom: 1px solid var(--color-primary); /* Ensure active tab bottom border matches */
        }
        body.dark-mode .software-tab-button.active {
            color: var(--color-secondary-text); 
        }
        .software-tab-content { display: none; }
        .software-tab-content.active { display: grid; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: var(--color-card-bg-alt); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--color-primary-hover); }

    </style>
</head>
<body>
    <div class="beta-watermark">
        <i class="fas fa-flask mr-1"></i> Site em Versão Beta. Novas funcionalidades e componentes em breve!
    </div>

    <main class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-12">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-3xl md:text-4xl font-bold text-left" style="color: var(--color-text-main);">DeiviTech</h1>
                <div>
                    <button id="theme-toggle" class="theme-toggle-btn mr-3" title="Alternar Tema">
                        <i class="fas fa-lightbulb"></i> <!-- Changes to fa-moon in JS -->
                    </button>
                    <button id="login-placeholder-btn" class="login-btn-placeholder py-2 px-4 rounded-lg text-sm" title="Login (Em Breve): Futuramente para histórico de pedidos e autenticação de trocas.">
                        <i class="fas fa-user mr-1"></i> Login (Em Breve)
                    </button>
                </div>
            </div>
            <h2 class="text-4xl md:text-5xl font-bold" style="color:var(--color-secondary); margin-top: -1rem;">Notebooks Personalizados</h2>
            <p class="mt-4 text-lg text-[var(--color-text-main)]">Escolha cada componente ou serviço e veja o preço em tempo real!</p>
            <div class="mt-8 flex justify-center gap-4">
                <button id="basic-mode-btn" class="mode-toggle-btn py-2 px-6 rounded-lg font-semibold active">Modo Básico</button>
                <button id="advanced-mode-btn" class="mode-toggle-btn py-2 px-6 rounded-lg font-semibold">Modo Avançado</button>
            </div>
        </header>
        
        <div class="mb-8">
            <div id="main-tabs-container" class="flex border-b border-[var(--color-border-subtle)] flex-wrap">
                <button id="tab-configure" class="tab-button active" onclick="showTab('configure')"><i class="fas fa-cogs mr-2"></i>Configurar Novo</button>
                <button id="tab-ready" class="tab-button" onclick="showTab('ready')"><i class="fas fa-laptop-medical mr-2"></i>Notebooks Prontos</button>
                <button id="tab-tradein" class="tab-button" onclick="showTab('tradein')"><i class="fas fa-recycle mr-2"></i>Trocar Notebook Usado</button>
                <button id="tab-services" class="tab-button" onclick="showTab('services')"><i class="fas fa-tools mr-2"></i>Formatação e Serviços</button>
                <button id="tab-specific-budget" class="advanced-mode-tab functional hidden" onclick="showTab('specific-budget')"><i class="fas fa-comments-dollar mr-2"></i>Orçamento Específico</button>
                <button id="tab-ai-integration" class="advanced-mode-tab hidden" title="Em Desenvolvimento"><i class="fas fa-brain mr-2"></i>Integração com IA (Em Breve)</button>
            </div>
        </div>

        <div id="configure-tab-content" class="tab-content active">
            <section id="quality-slider-section" class="card mb-12">
                <h2 class="text-2xl font-bold mb-4 text-center"><span class="section-icon">🌟</span>Configuração Rápida por Preset</h2>
                <div class="flex flex-col items-center">
                    <div class="w-full max-w-xl px-4">
                        <input type="range" id="quality-slider" min="0" max="2" value="1" class="w-full cursor-pointer">
                        <div class="flex justify-between text-sm text-[var(--color-text-card)] mt-2 px-1">
                            <span id="quality-label-0">Econômico</span>
                            <span id="quality-label-1" class="quality-label-active">Balanceado</span>
                            <span id="quality-label-2">Performance</span>
                        </div>
                    </div>
                    <p id="current-preset-display" class="mt-3 text-md text-[var(--color-text-card)] font-semibold">Preset Ativo: Balanceado</p>
                </div>
            </section>

            <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                <div class="lg:col-span-3 space-y-8">
                    <section class="card flex flex-col justify-center items-center p-6 bg-[var(--color-card-bg-alt)]">
                        <i class="fas fa-play-circle text-6xl text-[var(--color-primary)] mb-3"></i>
                        <p class="text-lg text-[var(--color-text-card)]">Conceito do Notebook em Funcionamento (Vídeo em Breve)</p>
                        <p class="text-sm text-gray-500 body.dark-mode:text-gray-400">Imagine seu notebook DeiviTech aqui!</p>
                    </section>
                    
                    <section id="platform-selection-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon"><i class="fas fa-layer-group"></i></span>1. Escolha a Plataforma</h2>
                        <div id="platform-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="casing-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">💻</span>2. Escolha a Carcaça</h2>
                        <div id="casing-options" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                    </section>

                    <section id="motherboard-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">🔩</span>3. Selecione a Placa Mãe</h2>
                        <p id="motherboard-helper-text" class="text-sm text-gray-500 body.dark-mode:text-gray-400 mb-4">Selecione uma plataforma (Intel/AMD) acima primeiro.</p>
                        <div id="motherboard-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="cpu-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon"><i class="fas fa-brain"></i></span>4. Selecione o Processador (CPU)</h2>
                        <p id="cpu-helper-text" class="text-sm text-gray-500 body.dark-mode:text-gray-400 mb-4">Selecione uma placa mãe compatível primeiro.</p>
                        <div id="cpu-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="ram-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">💾</span>5. Configure a Memória RAM</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="ram-type-select" class="block text-sm font-medium text-[var(--color-text-card)] mb-2">Módulos de RAM (DDR):</label>
                                <select id="ram-type-select" class="block w-full custom-select"> </select>
                                <p id="ram-type-helper-text" class="text-xs text-gray-500 body.dark-mode:text-gray-400 mt-1">O tipo de DDR é definido pela placa mãe.</p>
                            </div>
                            <div>
                                <label for="ram-quantity-input" class="block text-sm font-medium text-[var(--color-text-card)] mb-2">Quantidade de Módulos:</label>
                                <input type="number" id="ram-quantity-input" value="1" min="1" max="4" class="block w-full custom-input">
                                <p class="text-xs text-gray-500 body.dark-mode:text-gray-400 mt-1">Máximo de <span id="ram-max-modules">X</span> módulos (definido pela placa-mãe).</p>
                            </div>
                        </div>
                         <p class="mt-3 text-sm text-gray-600 body.dark-mode:text-gray-400">Oferecemos módulos DDR4 (Ex: 3200MHz, 3600MHz) e DDR5 (Ex: 5200MHz, 5600MHz, 6000MHz+), incluindo opções ECC para workstations. A compatibilidade e velocidade exata dependem da placa mãe selecionada.</p>
                    </section>

                    <section id="storage1-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">💽</span>6. Armazenamento Principal (SSD/NVMe)</h2>
                        <div id="storage1-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                         <p class="mt-3 text-sm text-gray-600 body.dark-mode:text-gray-400">Dispomos de SSDs SATA, NVMe PCIe Gen3, Gen4 e Gen5 para máxima performance. HDDs disponíveis para armazenamento secundário ou necessidades específicas.</p>
                    </section>

                    <section id="storage2-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">💿</span>7. Armazenamento Secundário (Opcional)</h2>
                        <div id="storage2-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div class="option-item" data-id="none" data-price="0" data-category="storage2">
                                <input type="radio" id="storage2-none" name="storage2" value="none" class="hidden">
                                <div class="option-content w-full">
                                    <p class="font-semibold text-name"><i class="fas fa-ban section-icon mr-2 text-lg"></i>Nenhum</p>
                                    <p class="text-sm text-description">Não adicionar armazenamento secundário.</p>
                                    <p class="text-sm price-text mt-auto">R$ 0,00</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <section id="os-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon"><i class="fab fa-linux"></i></span>8. Sistema Operacional</h2>
                        <p class="text-sm text-gray-600 body.dark-mode:text-gray-400 mb-3">Personalize seu Windows com perfis (Multimídia, Gamer, Corporativo) ou escolha sua distro Linux favorita. Software adicional pode ser selecionado na seção "Software Adicional Detalhado" abaixo.</p>
                        <div id="os-options" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        <div id="dualboot-section" class="mt-6 hidden">
                            <h3 class="text-xl font-semibold mb-3"><i class="fas fa-columns mr-2"></i>Opção de Dual Boot</h3>
                            <div class="checkbox-option-item">
                                <input type="checkbox" id="dualboot-checkbox" class="mr-3">
                                <label for="dualboot-checkbox" class="text-md">Ativar Dual Boot com um segundo Sistema Operacional?</label>
                            </div>
                            <div id="dualboot-os2-selection" class="mt-4 hidden">
                                <label for="os2-select" class="block text-sm font-medium mb-2">Selecione o Segundo SO:</label>
                                <select id="os2-select" class="custom-select w-full mb-3"></select>
                                <label for="dualboot-disk-select" class="block text-sm font-medium mb-2">Instalar Segundo SO em:</label>
                                <select id="dualboot-disk-select" class="custom-select w-full">
                                    <option value="same">Mesmo Disco (Principal)</option>
                                    <option value="additional" id="dualboot-additional-disk-option" disabled>Disco Adicional (Secundário)</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <section id="detailed-software-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon"><i class="fas fa-puzzle-piece"></i></span>9. Software Adicional Detalhado</h2>
                        <p id="detailed-software-helper-text" class="text-sm text-gray-500 body.dark-mode:text-gray-400 mb-4">Selecione um SO para ver opções de software. Softwares gratuitos não alteram o preço.</p>
                        <div id="software-tabs-container" class="software-tabs-container">
                            <!-- JS will populate these buttons -->
                            <button class="software-tab-button active" data-tab="multimedia">Multimídia</button>
                            <button class="software-tab-button" data-tab="design">Design/Criação</button>
                            <button class="software-tab-button" data-tab="development">Desenvolvimento (TI)</button>
                            <button class="software-tab-button" data-tab="productivity">Produtividade/Outros</button>
                        </div>
                        <div id="software-multimedia-tab" class="software-tab-content active grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        <div id="software-design-tab" class="software-tab-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        <div id="software-development-tab" class="software-tab-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        <div id="software-productivity-tab" class="software-tab-content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                    </section>

                    <section id="gpu-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">🎮</span>10. Placa de Vídeo (GPU)</h2>
                        <div id="gpu-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="display-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">🖥️</span>11. Tela</h2>
                        <div id="display-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="keyboard-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">⌨️</span>12. Teclado</h2>
                        <div id="keyboard-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="network-adapter-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">📶</span>13. Adaptador de Rede Wi-Fi e Bluetooth</h2>
                        <p class="text-sm text-gray-600 body.dark-mode:text-gray-400 mb-3">Escolha entre Wi-Fi 5, Wi-Fi 6/6E, até o novíssimo Wi-Fi 7, com versões de Bluetooth correspondentes (4.2, 5.2, 5.3, 5.4).</p>
                        <div id="network-adapter-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                         <p class="mt-4 text-sm text-gray-600 body.dark-mode:text-gray-400">Porta Ethernet: <span id="ethernet-info" class="font-semibold">Verifique a placa mãe</span></p>
                    </section>

                    <section id="battery-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">🔋</span>14. Bateria</h2>
                        <div id="battery-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </section>

                    <section id="peripherals-section" class="card">
                        <h2 class="text-2xl font-bold mb-6"><span class="section-icon">🖱️</span>15. Periféricos (Múltipla Escolha)</h2>
                        <div id="peripherals-options" class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-3"></div>
                    </section>
                     <div class="mt-10 text-center">
                        <button id="finalize-config-button" class="btn btn-primary btn-lg">
                            <i class="fas fa-shopping-cart mr-2"></i>Revisar e Encomendar Configuração
                        </button>
                    </div>
                </div>

                <div class="lg:col-span-1 mt-8 lg:mt-0">
                    <div class="sticky-summary card p-6">
                        <h2 class="text-2xl font-bold mb-2"><span class="section-icon">🛒</span>Seu Carrinho DeiviTech</h2>
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold text-center mb-1">Nível de Performance Estimado</h3>
                            <div id="performance-bar-container"><div id="performance-bar">0%</div></div>
                            <p id="performance-text-display" class="performance-text text-center">-</p>
                            <p id="energy-tendency-display" class="energy-tendency-text text-center mt-1">-</p>
                        </div>
                        <div id="summary-details" class="text-sm space-y-1 mb-6 max-h-[30rem] overflow-y-auto pr-2 custom-scrollbar"></div>
                        <div class="border-t-2 border-[var(--color-primary)] pt-4 mt-4">
                            <p class="text-2xl font-bold">Total Notebook: <span id="total-price-display" class="text-[var(--color-primary)]">R$ 0,00</span></p>
                        </div>
                        <button id="whatsapp-order-button" class="mt-6 w-full btn btn-secondary flex items-center justify-center">
                            <i class="fab fa-whatsapp mr-2 text-xl"></i> Encomendar Notebook via WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="ready-tab-content" class="tab-content">
            <h2 class="text-3xl font-bold mb-8 text-center text-[var(--color-text-card)]"><i class="fas fa-laptop-medical mr-3"></i>Notebooks Prontos para Você!</h2>
            <div id="ready-notebooks-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Notebooks prontos serão inseridos aqui -->
            </div>
        </div>
        
        <div id="tradein-tab-content" class="tab-content">
             <section id="tradein-section" class="card"> 
                <h2 class="text-2xl font-bold mb-6 text-[var(--color-accent-red)]"><span class="section-icon" style="color: var(--color-accent-red);">♻️</span>Troque Seu Notebook Usado e Ganhe Desconto!</h2>
                <p class="mb-4 text-sm text-gray-600 body.dark-mode:text-gray-400">Avalie seu notebook usado e obtenha um crédito para sua nova máquina DeiviTech. Siga os passos abaixo.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div> <label for="tradein-condition" class="block text-sm font-medium text-[var(--color-text-card)] mb-2">Condição Geral:</label> <select id="tradein-condition" class="block w-full custom-select"> <option value="excellent">Excelente (Como novo)</option> <option value="good">Boa (Pequenas marcas de uso)</option> <option value="fair">Razoável (Marcas visíveis, funcional)</option> <option value="poor">Ruim (Defeitos, peças faltando)</option> </select> </div>
                    <div> <label for="tradein-age" class="block text-sm font-medium text-[var(--color-text-card)] mb-2">Idade Aproximada:</label> <select id="tradein-age" class="block w-full custom-select"> <option value="<1year">&lt; 1 ano</option> <option value="1-2years">1-2 anos</option> <option value="2-3years">2-3 anos</option> <option value=">3years">&gt; 3 anos</option> </select> </div>
                    <div class="md:col-span-2"> <label for="tradein-specs" class="block text-sm font-medium text-[var(--color-text-card)] mb-2">Nível de Especificações Originais:</label> <select id="tradein-specs" class="block w-full custom-select"> <option value="high-end">Alto Desempenho (Ex: Core i7/Ryzen 7+, GPU dedicada)</option> <option value="mid-range">Médio Desempenho (Ex: Core i5/Ryzen 5, GPU básica ou integrada)</option> <option value="low-end">Baixo Desempenho (Ex: Celeron/Atom, uso básico)</option> </select> </div>
                </div>
                <button id="calculate-tradein" class="w-full btn btn-danger mb-4">Calcular Valor de Troca Estimado</button>
                <p id="tradein-value-display" class="text-center text-lg font-bold text-[var(--color-accent-red)]">Valor Estimado: R$ 0,00</p>
                
                <div class="mt-8 border-t border-[var(--color-border-subtle)] pt-6">
                    <h3 class="text-xl font-bold text-[var(--color-accent-red)] mb-2">Avaliação Detalhada com Relatório do Sistema (Opcional, Maior Precisão)</h3>
                    <p class="text-sm text-gray-600 body.dark-mode:text-gray-400 mb-3">Para uma avaliação mais precisa, gere um relatório do seu sistema e envie o arquivo. Nossa I.A. (simulada) analisará e poderá oferecer um valor melhor. Estimamos um crédito de até 50% do valor de mercado das peças principais usadas.</p>
                    
                    <details class="mb-4">
                        <summary class="cursor-pointer text-[var(--color-primary)] hover:underline">Como gerar o relatório do sistema? (Clique para expandir)</summary>
                        <div class="tutorial-details text-sm space-y-2">
                            <p><strong>Opção 1: Usando o DxDiag (Windows)</strong></p>
                            <ol class="list-decimal list-inside ml-4">
                                <li>Pressione as teclas `Windows + R` para abrir a caixa "Executar".</li>
                                <li>Digite `dxdiag` e pressione Enter.</li>
                                <li>Aguarde a ferramenta carregar. Se perguntar sobre drivers assinados digitalmente, pode clicar em Sim ou Não.</li>
                                <li>Clique no botão "Salvar informações..." ou "Save All Information...".</li>
                                <li>Salve o arquivo como `.txt` (ex: `meu_pc_specs.txt`).</li>
                                <li>Faça o upload deste arquivo abaixo.</li>
                            </ol>
                            <p><strong>Opção 2: Usando CPU-Z (Windows)</strong></p>
                             <ol class="list-decimal list-inside ml-4">
                                <li>Baixe e instale o CPU-Z (gratuito em cpuid.com).</li>
                                <li>Abra o CPU-Z.</li>
                                <li>Vá na aba "About" (ou "Sobre").</li>
                                <li>Na seção "Tools" (ou "Ferramentas"), clique em "Save Report (.TXT)" ou "Save Report (.HTML)".</li>
                                <li>Salve o arquivo e faça o upload abaixo.</li>
                            </ol>
                             <p><strong>Outras Ferramentas:</strong> Relatórios de ferramentas como Speccy, HWiNFO, ou informações do sistema do Linux (`lshw`, `inxi`) também podem ser úteis, preferencialmente em formato .txt ou .html.</p>
                        </div>
                    </details>

                    <input type="file" id="system-info-file" accept=".txt,.html,.json" class="block w-full text-sm file-input-styled mb-3">
                    <button id="upload-info-btn" class="mt-1 w-full btn btn-danger">Processar Relatório para Avaliação Detalhada</button>
                    <p id="file-evaluation-result" class="mt-4 text-center text-md text-[var(--color-accent-red)]"></p>
                </div>
            </section>
        </div>

        <div id="services-tab-content" class="tab-content">
            <h2 class="text-3xl font-bold mb-6 text-center text-[var(--color-text-card)]"><i class="fas fa-tools mr-3"></i>Formatação, Upgrades e Serviços DeiviTech</h2>
            <p class="text-center text-gray-600 body.dark-mode:text-gray-400 mb-8">Precisa dar um UP no seu notebook atual ou apenas de uma formatação caprichada? Confira nossos serviços! Selecione os desejados para orçamento.</p>
            
            <div id="services-options-container" class="space-y-4">
                <!-- Services will be populated here by JS -->
            </div>

            <div class="mt-8 border-t border-[var(--color-border-subtle)] pt-4">
                <p class="text-xl font-bold text-right">Total Serviços: <span id="total-services-price-display" class="text-[var(--color-primary)]">R$ 0,00</span></p>
                 <button id="whatsapp-services-order-button" class="mt-6 w-full btn btn-primary flex items-center justify-center"> <!-- Changed to btn-primary for more emphasis -->
                    <i class="fab fa-whatsapp mr-2 text-xl"></i> Solicitar Orçamento de Serviços
                </button>
            </div>
            <p class="mt-8 text-sm text-gray-500 body.dark-mode:text-gray-400 text-center">Todos os serviços são realizados com peças de qualidade e garantia. Respeitamos integralmente a Lei Geral de Proteção de Dados (LGPD) em todos os procedimentos que envolvem dados do cliente.</p>
        </div>

        <div id="specific-budget-tab-content" class="tab-content">
            <h2 class="text-3xl font-bold mb-6 text-center text-[var(--color-text-card)]"><i class="fas fa-comments-dollar mr-3"></i>Orçamento Específico</h2>
            <p class="text-center text-gray-600 body.dark-mode:text-gray-400 mb-6">Tem uma necessidade muito específica, um componente que não encontrou, ou um projeto especial em mente (Ex: Hackintosh, servidor caseiro)? Descreva abaixo e solicite um orçamento personalizado diretamente conosco.</p>
            <div class="max-w-lg mx-auto">
                <textarea id="specific-budget-request" class="custom-textarea w-full h-40 mb-4" placeholder="Descreva sua necessidade, componentes desejados, casos de uso, ou qualquer detalhe para seu orçamento personalizado..."></textarea>
                <button id="send-specific-budget-request" class="w-full btn btn-primary">
                    <i class="fab fa-whatsapp mr-2"></i>Solicitar Orçamento Personalizado via WhatsApp
                </button>
            </div>
        </div>
        
        <footer class="text-center mt-16 pt-8 border-t border-[var(--color-primary-light)] opacity-90">
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-[var(--color-secondary)] mb-4">Pagamento Facilitado</h3>
                <div class="flex justify-center items-center space-x-1 payment-logos">
                    <a href="https://www.visa.com.br" target="_blank" title="Visa"><i class="fab fa-cc-visa"></i></a>
                    <a href="https://www.mastercard.com.br" target="_blank" title="Mastercard"><i class="fab fa-cc-mastercard"></i></a>
                    <a href="https://www.elo.com.br" target="_blank" title="Elo"><i class="fab fa-cc-elo"></i></a>
                    <a href="https://www.americanexpress.com/pt-br/" target="_blank" title="American Express"><i class="fab fa-cc-amex"></i></a>
                    <a href="https://www.hipercard.com.br" target="_blank" title="Hipercard"><i class="fas fa-credit-card"></i></a> <!-- Generic card for Hipercard -->
                    <a href="https://www.paypal.com/br" target="_blank" title="PayPal"><i class="fab fa-cc-paypal"></i></a>
                    <a href="https://www.mercadopago.com.br/" target="_blank" title="Mercado Pago"><i class="fas fa-handshake"></i></a> <!-- Handshake for MercadoPago -->
                </div>
                 <p class="text-xs text-[var(--color-text-main)] opacity-70 mt-3">Este site é um configurador para orçamento. Nenhuma transação financeira é realizada aqui.</p>
            </div>

            <div class="contact-links space-x-4 mb-4 text-lg">
                <a href="https://www.linkedin.com/in/deivilsantana/" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a>
                <a href="https://github.com/Deivisan" target="_blank"><i class="fab fa-github"></i> GitHub</a>
                <a href="mailto:deivilsantana@outlook.com"><i class="fas fa-envelope"></i> E-mail</a>
                <a href="https://wa.me/5575981231019" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                <a href="https://t.me/+5575981231019" target="_blank"><i class="fab fa-telegram"></i> Telegram</a>
            </div>
            <p class="text-[var(--color-text-main)] text-sm">&copy; <span id="current-year"></span> DeiviTech por Deivison Santana. Todos os direitos reservados.</p>
            <p class="text-xs text-[var(--color-text-main)] opacity-70 mt-1">Preços e disponibilidade são estimativas e sujeitos a confirmação.</p>
        </footer>
    </main>

    <div id="order-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modal-title" class="text-2xl font-bold mb-4">Confirmação</h2>
            <div id="modal-message-content" class="mb-4"></div>
            <div id="modal-order-summary" class="bg-[var(--color-card-bg-alt)] p-4 rounded-lg border border-[var(--color-border-subtle)] text-sm max-h-60 overflow-y-auto custom-scrollbar"></div>
            <p class="text-lg font-bold mt-4">Total Estimado: <span id="modal-total-price" class="text-[var(--color-primary)]">R$ 0,00</span></p>
            <!-- WhatsApp button will be inserted here by JS -->
            <button id="modal-close-button" class="mt-6 w-full btn btn-secondary">Fechar</button>
        </div>
    </div>

    <script>
        // GENERAL INITIALIZATION
        document.getElementById('current-year').textContent = new Date().getFullYear();
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('in-view'); observer.unobserve(entry.target); }});
        }, { threshold: 0.05 });
        function observeSections() { document.querySelectorAll('section.card, .ready-notebook-card, .service-item, .tab-content').forEach(section => { observer.observe(section); }); }

        // GLOBAL STATE VARIABLES
        let selectedPlatform = null;
        let selectedComponents = {
            platform: null, casing: null, motherboard: null, cpu: null,
            ram: { type: null, quantity: 1 },
            storage1: { type: null }, storage2: { type: 'none' },
            gpu: null, display: null, keyboard: null, os: null,
            os2: null, dualboot_disk: 'same', 
            network_adapter: null, battery: null,
            peripherals: [], 
            software: [] // Consolidated array for all selected software
        };
        let selectedServices = []; // Array of service IDs
        let tradeInCredit = 0;
        let currentMode = 'basic';
        let currentPresetName = "Balanceado";
        let activeTab = 'configure'; 
        let currentSoftwareTab = 'multimedia'; // Default software sub-tab


        // DATA (Components, Presets, Ready Notebooks, Software Categories, Services)
        const components = {
            platform: [
                { id: 'intel', name: 'Plataforma Intel', price: 0, stock: 50, performance_score: 0, icon: 'fab fa-intel', description_basic: 'Processadores e chipsets Intel.', description_advanced: 'Ideal para uma vasta gama de aplicações, desde produtividade a gaming de ponta, com tecnologias como Thunderbolt e suporte a memórias DDR4/DDR5 dependendo do chipset. Ótima compatibilidade de software.' },
                { id: 'amd', name: 'Plataforma AMD', price: 0, stock: 45, performance_score: 0, icon: 'fa-brands fa-amd', description_basic: 'Processadores e chipsets AMD.', description_advanced: 'Foco em multitarefas e eficiência energética com CPUs Ryzen. Excelente performance em jogos e criação de conteúdo, especialmente com APUs potentes (gráficos integrados). Suporte a DDR4/DDR5.' }
            ],
            casing: [ 
                { id: 'casing-eco', name: 'Carcaça EcoFlex Preta', price: 95, stock: 20, performance_score: 5, icon: 'fas fa-box-open', description_basic: 'Funcional e leve.', description_advanced: 'Policarbonato reciclado, ventilação básica, design minimalista, 1x USB 3.0, 2x USB 2.0.' },
                { id: 'casing-silverstone', name: 'Carcaça SilverStone Slim Prata', price: 125, stock: 18, performance_score: 10, icon: 'fas fa-laptop', description_basic: 'Elegante e portátil.', description_advanced: 'Liga de alumínio escovado fina, ideal para portabilidade com estilo. 2x USB 3.1, 1x USB-C.' },
                { id: 'casing-pro-alum', name: 'Carcaça Pro Alumínio Grafite', price: 280, stock: 12, performance_score: 15, icon: 'fas fa-laptop-code', description_basic: 'Robusta, alumínio premium.', description_advanced: 'Chassi unibody em alumínio aeroespacial, dissipação térmica superior, durabilidade extra. 2x USB 3.2, 1x Thunderbolt 4 (se mobo suportar).' },
                { id: 'casing-gamer-rgb', name: 'Carcaça Gamer RGB Fusion X', price: 340, stock: 10, performance_score: 20, icon: 'fas fa-gamepad', description_basic: 'Design agressivo, RGB.', description_advanced: 'Compósito com zonas RGB personalizáveis, fluxo de ar otimizado para gaming intenso, múltiplas portas USB 3.2, áudio aprimorado.' },
                { id: 'casing-ultrabook-mag', name: 'Carcaça Ultrabook Magnésio Sky', price: 390, stock: 8, performance_score: 18, icon: 'fas fa-feather-alt', description_basic: 'Ultra fina e leve.', description_advanced: 'Liga de magnésio, perfil <13mm, peso <1.1kg, máxima portabilidade e design sofisticado. 2x USB-C (Thunderbolt opcional).' },
                { id: 'casing-workstation', name: 'Carcaça Workstation Titan Pro', price: 450, stock: 6, performance_score: 22, advanced_only: true, icon: 'fas fa-briefcase', description_basic: 'Durabilidade e expansão.', description_advanced: 'Estrutura reforçada, múltiplas baias internas (se aplicável ao form factor), ventilação robusta, ideal para workstations móveis de alta performance. Suporte a múltiplas conexões I/O.' },
                { id: 'casing-convertible', name: 'Carcaça Convertível Stylus Air', price: 480, stock: 7, performance_score: 16, advanced_only: true, icon: 'fas fa-tablet-alt', description_basic: '2-em-1 com caneta.', description_advanced: 'Dobradiça 360°, tela touch (requer tela compatível), chassi leve e versátil para criatividade. Inclui slot para caneta stylus (caneta opcional).' },
            ],
             motherboard: [ 
                { id: 'intel-h610m', name: 'Intel H610M Chipset', price: 160, platform: 'intel', cpu_socket: 'LGA1700', ram_type: 'DDR4', ram_slots: 2, nvme_slots: 1, sata_ports: 2, pcie_gen: 'Gen4', ethernet_speed: '1Gbps', stock: 20, performance_score: 20, basic_only: true, icon: 'fas fa-microchip', description_basic: 'Entrada, DDR4.', description_advanced: 'Chipset H610, 2x DDR4 SO-DIMM (máx 64GB @3200MHz), 1x M.2 PCIe 3.0 x4, 2x SATA III, USB 3.2 Gen1. Ideal para tarefas básicas e CPUs de entrada.' },
                { id: 'intel-b760m-wifi', name: 'Intel B760M Wi-Fi', price: 250, platform: 'intel', cpu_socket: 'LGA1700', ram_type: 'DDR4', ram_slots: 4, nvme_slots: 2, sata_ports: 4, pcie_gen: 'Gen4', ethernet_speed: '2.5Gbps', stock: 15, performance_score: 35, icon: 'fas fa-wifi', description_basic: 'Intermediária, DDR4, Wi-Fi.', description_advanced: 'Chipset B760, 4x DDR4 SO-DIMM (máx 128GB @3200MHz+), 2x M.2 PCIe 4.0 x4, Wi-Fi 6 integrado, Bluetooth 5.2, USB 3.2 Gen2. Bom para jogos e produtividade.' }, 
                { id: 'intel-z790-pro-wifi', name: 'Intel Z790 Pro Wi-Fi DDR5', price: 450, platform: 'intel', cpu_socket: 'LGA1700', ram_type: 'DDR5', ram_slots: 4, nvme_slots: 3, sata_ports: 4, pcie_gen: 'Gen5', ethernet_speed: '2.5Gbps', stock: 10, performance_score: 60, advanced_only: true, icon: 'fas fa-broadcast-tower', description_basic: 'Avançada, DDR5, Wi-Fi 6E.', description_advanced: 'Chipset Z790, 4x DDR5 SO-DIMM (máx 192GB @5600MHz+), 3x M.2 (1x PCIe 5.0 x4, 2x PCIe 4.0 x4), Wi-Fi 6E, Bluetooth 5.3, Thunderbolt 4 header, áudio premium. Para overclock e CPUs high-end.' },
                { id: 'intel-w790-ace', name: 'Intel W790 ACE (Workstation)', price: 650, platform: 'intel', cpu_socket: 'LGA4677', ram_type: 'DDR5-ECC-RDIMM', ram_slots: 8, nvme_slots: 4, sata_ports: 8, pcie_gen: 'Gen5', ethernet_speed: '10Gbps', stock: 5, performance_score: 75, advanced_only: true, icon: 'fas fa-server', description_basic: 'Xeon, ECC RAM.', description_advanced: 'Para CPUs Intel Xeon W-2400/W-3400. 8x DDR5 ECC RDIMM slots, Quad M.2 PCIe 5.0, Dual 10GbE LAN, múltiplos slots PCIe x16. Focada em estabilidade e performance profissional.' }, 
                { id: 'custom-arm-copilot', name: 'Placa Custom ARM Copilot+', price: 0, platform: 'arm', cpu_socket: 'ARM-Copilot', ram_type: 'LPDDR5X', ram_slots: 1, nvme_slots: 1, sata_ports: 0, pcie_gen: 'Gen4', ethernet_speed: 'N/A', stock: 5, performance_score: 50, advanced_only:true, icon: 'fas fa-microchip-ai', description_advanced:'Placa mãe customizada para processadores ARM de alta performance como Snapdragon X Elite, otimizada para eficiência energética e IA on-device. RAM geralmente soldada.' },
                { id: 'amd-a620m', name: 'AMD A620M Chipset', price: 145, platform: 'amd', cpu_socket: 'AM5', ram_type: 'DDR5', ram_slots: 2, nvme_slots: 1, sata_ports: 2, pcie_gen: 'Gen4', ethernet_speed: '1Gbps', stock: 18, performance_score: 22, basic_only: true, icon: 'fas fa-microchip', description_basic: 'Entrada AM5, DDR5.', description_advanced: 'Chipset A620, 2x DDR5 SO-DIMM (máx 96GB @5200MHz), 1x M.2 PCIe 4.0 x4, USB 3.2 Gen2. Entrada para a plataforma AM5 Ryzen 7000/8000.' },
                { id: 'amd-b650m-plus-wifi', name: 'AMD B650M Plus Wi-Fi', price: 260, platform: 'amd', cpu_socket: 'AM5', ram_type: 'DDR5', ram_slots: 4, nvme_slots: 2, sata_ports: 4, pcie_gen: 'Gen4', ethernet_speed: '2.5Gbps', stock: 14, performance_score: 40, icon: 'fas fa-wifi', description_basic: 'Intermediária AM5, DDR5, Wi-Fi.', description_advanced: 'Chipset B650, 4x DDR5 SO-DIMM (máx 192GB @6000MHz+), 2x M.2 (1x PCIe 5.0 x4, 1x PCIe 4.0 x4), Wi-Fi 6E, Bluetooth 5.2. Ótimo custo-benefício para Ryzen 7000/8000.' }, 
                { id: 'amd-x670e-extreme', name: 'AMD X670E Extreme Gaming', price: 520, platform: 'amd', cpu_socket: 'AM5', ram_type: 'DDR5', ram_slots: 4, nvme_slots: 4, sata_ports: 6, pcie_gen: 'Gen5', ethernet_speed: '10Gbps', stock: 7, performance_score: 68, advanced_only: true, icon: 'fas fa-dragon', description_basic: 'High-end AM5, PCIe 5.0.', description_advanced: 'Chipset X670E, 4x DDR5 SO-DIMM (suporte a EXPO), Quad M.2 PCIe 5.0, 10GbE LAN, Wi-Fi 7 (dependendo do lote), áudio de alta definição, VRM robusto para overclock.' },
                { id: 'amd-wrx90e-pro-sage', name: 'AMD WRX90 Pro SAGE (Threadripper)', price: 950, platform: 'amd', cpu_socket: 'sTR5', ram_type: 'DDR5-ECC-RDIMM', ram_slots: 8, nvme_slots: 5, sata_ports: 8, pcie_gen: 'Gen5', ethernet_speed: 'Dual 10Gbps', stock: 3, performance_score: 85, advanced_only: true, icon: 'fas fa-cogs', description_basic: 'Threadripper Pro, ECC.', description_advanced: 'Para AMD Ryzen Threadripper PRO 7000 WX-Series. 8x DDR5 ECC RDIMM (octa-channel), Penta M.2 PCIe 5.0, Múltiplos slots PCIe 5.0 x16. Para cargas de trabalho extremas.' },
            ],
            cpu: [ 
                { id: 'intel-i3-13100f', name: 'Intel Core i3-13100F', price: 380, socket: 'LGA1700', performance_score: 45, stock: 25, icon: 'fas fa-brain', description_basic: 'Entrada eficiente (4C/8T).', description_advanced: '4 Cores Performance, 8 Threads, até 4.5GHz. Sem gráficos integrados (requer GPU dedicada). Bom para tarefas do dia a dia e jogos leves.' }, 
                { id: 'intel-i5-14400f', name: 'Intel Core i5-14400F', price: 600, socket: 'LGA1700', performance_score: 65, stock: 20, icon: 'fas fa-brain', description_basic: 'Bom custo-benefício (10C/16T).', description_advanced: '6 Performance-cores + 4 Efficient-cores, 16 Threads, até 4.7GHz. Sem gráficos integrados. Ótimo para jogos e multitarefas.' }, 
                { id: 'intel-i7-14700k', name: 'Intel Core i7-14700K', price: 1100, socket: 'LGA1700', performance_score: 88,stock: 10, advanced_only: true, icon: 'fas fa-brain', description_basic: 'Alta performance (20C/28T).', description_advanced: '8 Performance-cores + 12 Efficient-cores, 28 Threads, até 5.6GHz. Gráficos Intel UHD 770. Suporte a IA via software. Desbloqueado para overclock.' },
                { id: 'intel-i9-14900ks', name: 'Intel Core i9-14900KS', price: 1900, socket: 'LGA1700', performance_score: 105, stock: 5, advanced_only: true, icon: 'fas fa-brain', description_basic: 'Performance extrema (24C/32T).', description_advanced: '8 Performance-cores + 16 Efficient-cores, 32 Threads, até 6.2GHz com Thermal Velocity Boost. Gráficos Intel UHD 770. Edição especial para máximo desempenho.' },
                { id: 'intel-xeon-w5-2455x', name: 'Intel Xeon W5-2455X', price: 2800, socket: 'LGA4677', performance_score: 110, stock: 4, advanced_only: true, icon: 'fas fa-server', description_basic: 'Workstation potente (12C/24T).', description_advanced: '12 Cores, 24 Threads, até 4.8GHz. Para tarefas profissionais intensas como renderização e CAD. Suporte a RAM ECC e múltiplas linhas PCIe.' },
                { id: 'amd-r5-7500f', name: 'AMD Ryzen 5 7500F', price: 580, socket: 'AM5', performance_score: 68, stock: 18, icon: 'fas fa-brain', description_basic: 'Ótimo p/ jogos (6C/12T).', description_advanced: '6 Cores, 12 Threads, até 5.0GHz. Sem gráficos integrados. Excelente performance em jogos com bom custo-benefício na plataforma AM5.' }, 
                { id: 'amd-r7-8700g', name: 'AMD Ryzen 7 8700G (c/ NPU)', price: 1050, socket: 'AM5', performance_score: 78, stock: 12, icon: 'fas fa-microchip-ai', npu: true, description_basic: 'CPU c/ NPU e iGPU potente (8C/16T).', description_advanced: '8 Cores, 16 Threads, até 5.1GHz. Radeon 780M Graphics (iGPU poderosa). Inclui Ryzen AI (NPU XDNA) para aceleração de IA local. Ótimo para PCs compactos ou sem GPU dedicada.' }, 
                { id: 'amd-r9-7950x3d', name: 'AMD Ryzen 9 7950X3D (3D V-Cache)', price: 2300, socket: 'AM5', performance_score: 115, stock: 6, advanced_only: true, icon: 'fas fa-gamepad-alt', description_basic: 'Gaming máximo (16C/32T).', description_advanced: '16 Cores, 32 Threads, até 5.7GHz. Tecnologia 3D V-Cache para performance superior em jogos. Ideal para entusiastas.' },
                { id: 'amd-trpro-7975wx', name: 'AMD Threadripper PRO 7975WX', price: 7500, socket: 'sTR5', performance_score: 180, stock: 2, advanced_only: true, icon: 'fas fa-industry-alt', description_basic: 'Workstation extrema (32C/64T).', description_advanced: '32 Cores, 64 Threads, até 5.3GHz. Para renderização 3D, simulação complexa, análise de dados massiva e virtualização pesada. Plataforma sTR5.' },
                { id: 'snapdragon-x-elite', name: 'Snapdragon X Elite', price: 0, socket: 'ARM-Copilot', npu: true, performance_score: 80, stock: 5, advanced_only: true, icon: 'fas fa-brain-circuit', description_basic: 'ARM c/ NPU para Copilot+ PCs.', description_advanced: 'Arquitetura ARM de alta performance com NPU dedicada (45 TOPS) para Copilot+ PCs. Foco em eficiência energética, longa duração de bateria e IA on-device. Preço integrado à placa-mãe/plataforma ARM.' },
            ],
            ram: [ 
                { id: 'ddr4-8gb-3200-1pk', name: '8GB DDR4 3200MHz (1x8GB)', price: 85, type: 'DDR4', performance_score: 20, stock: 30, icon: 'fas fa-memory', description_advanced: 'Módulo único de 8GB DDR4 SO-DIMM a 3200MHz. Ideal para tarefas básicas e sistemas de entrada.' }, 
                { id: 'ddr4-16gb-3200-2pk', name: '16GB DDR4 3200MHz (2x8GB)', price: 150, type: 'DDR4', performance_score: 30, stock: 25, icon: 'fas fa-memory', description_advanced: 'Kit dual-channel de 16GB (2x8GB) DDR4 SO-DIMM a 3200MHz. Bom para multitarefas e jogos.' }, 
                { id: 'ddr4-32gb-3600-2pk', name: '32GB DDR4 3600MHz (2x16GB)', price: 290, type: 'DDR4', performance_score: 40, stock: 12,icon: 'fas fa-memory', description_advanced: 'Kit dual-channel de 32GB (2x16GB) DDR4 SO-DIMM a 3600MHz. Para usuários avançados e multitarefas intensas.' }, 
                { id: 'ddr5-16gb-5200-1pk', name: '16GB DDR5 5200MHz (1x16GB)', price: 180, type: 'DDR5', performance_score: 38, stock: 22, icon: 'fas fa-memory', description_advanced: 'Módulo único de 16GB DDR5 SO-DIMM a 5200MHz. Padrão mais recente para melhor largura de banda.' }, 
                { id: 'ddr5-32gb-5600-2pk', name: '32GB DDR5 5600MHz (2x16GB)', price: 350, type: 'DDR5', performance_score: 55, stock: 18, icon: 'fas fa-memory', description_advanced: 'Kit dual-channel de 32GB (2x16GB) DDR5 SO-DIMM a 5600MHz. Excelente para gaming e aplicações exigentes.' }, 
                { id: 'ddr5-64gb-6000-2pk', name: '64GB DDR5 6000MHz (2x32GB)', price: 680, type: 'DDR5', performance_score: 70, stock: 8, advanced_only: true, icon: 'fas fa-memory', description_advanced: 'Kit dual-channel de 64GB (2x32GB) DDR5 SO-DIMM a 6000MHz. Para workstations e tarefas que demandam muita memória.' },
                { id: 'ddr5-ecc-rd-32gb-4800-1pk', name: '32GB DDR5 ECC RDIMM 4800MHz (1x32GB)', price: 450, type: 'DDR5-ECC-RDIMM', performance_score: 60, stock: 6, advanced_only: true, icon: 'fas fa-shield-alt', description_advanced: 'Módulo único de 32GB DDR5 ECC Registrada SO-DIMM a 4800MHz. Para workstations Xeon/Threadripper que exigem correção de erros.' },
                { id: 'ddr5-ecc-rd-64gb-5200-2pk', name: '64GB DDR5 ECC RDIMM 5200MHz (2x32GB)', price: 950, type: 'DDR5-ECC-RDIMM', performance_score: 80, stock: 4, advanced_only: true, icon: 'fas fa-server', description_advanced: 'Kit dual-channel de 64GB (2x32GB) DDR5 ECC Registrada SO-DIMM a 5200MHz. Alta capacidade e confiabilidade para servidores e workstations.' },
                 { id: 'lpddr5x-16gb', name: '16GB LPDDR5X (Onboard)', price: 0, type: 'LPDDR5X', performance_score: 45, stock: 5, advanced_only: true, icon: 'fas fa-memory', description_advanced: 'Memória LPDDR5X de 16GB soldada na placa, otimizada para baixo consumo e alta largura de banda em plataformas ARM. Preço integrado à placa-mãe/plataforma ARM.' },
            ],
            storage: [ 
                { id: 'sata-ssd-500gb', name: 'SSD SATA 500GB Econômico', price: 120, interface: 'SATA', performance_score: 30, stock: 25, icon: 'fas fa-hdd', description_advanced: 'SSD de 500GB com interface SATA III (até 550MB/s). Bom para upgrade de HDDs e sistemas de entrada.' }, 
                { id: 'sata-ssd-1tb', name: 'SSD SATA 1TB Plus', price: 200, interface: 'SATA', performance_score: 35, stock: 20, icon: 'fas fa-hdd', description_advanced: 'SSD de 1TB com interface SATA III. Mais espaço com boa velocidade para o padrão SATA.' }, 
                { id: 'nvme-gen3-512gb', name: 'SSD NVMe 512GB (PCIe 3.0)', price: 150, interface: 'NVMe', pcie_gen: 'Gen3', performance_score: 48, stock: 22, icon: 'fas fa-compact-disc', description_advanced: 'SSD NVMe de 512GB, interface PCIe 3.0 x4 (até 3500MB/s). Velocidade significativamente maior que SATA.' }, 
                { id: 'nvme-gen4-1tb', name: 'SSD NVMe 1TB (PCIe 4.0) Veloz', price: 290, interface: 'NVMe', pcie_gen: 'Gen4', performance_score: 70, stock: 15, icon: 'fas fa-compact-disc', description_advanced: 'SSD NVMe de 1TB, interface PCIe 4.0 x4 (até 7000MB/s). Ideal para jogos, edição de vídeo e SO.' },
                { id: 'nvme-gen4-2tb', name: 'SSD NVMe 2TB (PCIe 4.0) Ultra', price: 500, interface: 'NVMe', pcie_gen: 'Gen4', performance_score: 80, stock: 10, advanced_only: true, icon: 'fas fa-compact-disc', description_advanced: 'SSD NVMe de 2TB, interface PCIe 4.0 x4. Grande capacidade com velocidades altíssimas.' },
                 { id: 'nvme-gen4-512gb', name: 'SSD NVMe 512GB (PCIe 4.0) Rápido', price: 220, interface: 'NVMe', pcie_gen: 'Gen4', performance_score: 65, stock: 10, icon: 'fas fa-compact-disc', description_advanced: 'SSD NVMe de 512GB, interface PCIe 4.0 x4 (até 7000MB/s). Ponto de entrada veloz para sistemas Gen4.' },
                { id: 'nvme-gen5-1tb', name: 'SSD NVMe 1TB (PCIe 5.0) Extreme', price: 450, interface: 'NVMe', pcie_gen: 'Gen5', performance_score: 95, stock: 7, advanced_only: true, icon: 'fas fa-rocket', description_advanced: 'SSD NVMe de 1TB, interface PCIe 5.0 x4 (até 12000MB/s+). Tecnologia de ponta para máxima performance, requer placa-mãe compatível.' },
                { id: 'nvme-gen5-2tb', name: 'SSD NVMe 2TB (PCIe 5.0) Monstro', price: 800, interface: 'NVMe', pcie_gen: 'Gen5', performance_score: 110, stock: 5, advanced_only: true, icon: 'fas fa-rocket', description_advanced: 'SSD NVMe de 2TB, interface PCIe 5.0 x4. Capacidade e velocidade extremas para os usuários mais exigentes.' },
                { id: 'hdd-2tb-7200', name: 'HDD 2TB (7200RPM) Arquivos', price: 160, interface: 'SATA', performance_score: 15, stock: 12, advanced_only: true, icon: 'fas fa-database', description_advanced: 'Hard Disk Drive de 2TB, 7200RPM, interface SATA. Bom para armazenamento em massa de arquivos grandes, backups.' },
                { id: 'hdd-4tb-5400', name: 'HDD 4TB (5400RPM) Backup', price: 280, interface: 'SATA', performance_score: 12, stock: 8, advanced_only: true, icon: 'fas fa-archive', description_advanced: 'Hard Disk Drive de 4TB, 5400RPM, interface SATA. Grande capacidade para backups e armazenamento de longo prazo, menor consumo de energia.' },
            ],
            gpu: [ 
                { id: 'integrated', name: 'GPU Integrada (Processador)', price: 0, pcie_gen: 'N/A', performance_score: 15, stock: 999, icon: 'fas fa-image', description_advanced: 'Utiliza os gráficos integrados ao processador (ex: Intel UHD/Iris Xe, AMD Radeon Graphics). Adequada para tarefas básicas, multimídia e jogos muito leves. O desempenho varia conforme a CPU.' }, 
                { id: 'adreno-copilot', name: 'GPU Adreno (Snapdragon)', price: 0, pcie_gen: 'N/A', performance_score: 60, stock: 5, advanced_only:true, icon: 'fas fa-mobile-alt', description_advanced: 'GPU Adreno integrada ao Snapdragon X Elite, oferecendo bom desempenho gráfico para tarefas do dia a dia, multimídia e jogos leves com alta eficiência energética. Preço integrado.' },
                { id: 'nvidia-gtx-1650s', name: 'NVIDIA GTX 1650 Super (4GB GDDR6)', price: 450, pcie_gen: 'Gen3', performance_score: 40, stock: 12, icon: 'fas fa-gamepad', description_advanced: 'NVIDIA GeForce GTX 1650 Super com 4GB de memória GDDR6. Boa para jogos em 1080p com configurações médias.' }, 
                { id: 'nvidia-rtx-3050-6gb', name: 'NVIDIA RTX 3050 (6GB GDDR6)', price: 650, pcie_gen: 'Gen4', performance_score: 58, stock: 15, icon: 'fas fa-gamepad', description_advanced: 'NVIDIA GeForce RTX 3050 com 6GB GDDR6. Suporte a Ray Tracing e DLSS. Boa para jogos em 1080p (médio-alto).' }, 
                { id: 'nvidia-rtx-4060-8gb', name: 'NVIDIA RTX 4060 (8GB GDDR6)', price: 1100, pcie_gen: 'Gen4', performance_score: 80, stock: 10, icon: 'fas fa-gamepad', description_advanced: 'NVIDIA GeForce RTX 4060 com 8GB GDDR6. Arquitetura Ada Lovelace, eficiente e com DLSS 3. Excelente para 1080p/1440p gaming.' },
                { id: 'nvidia-rtx-4070ti-12gb', name: 'NVIDIA RTX 4070 Ti (12GB GDDR6X)', price: 2100, pcie_gen: 'Gen4', performance_score: 110, stock: 7, advanced_only: true, icon: 'fas fa-fighter-jet', description_advanced: 'NVIDIA GeForce RTX 4070 Ti com 12GB GDDR6X. Alto desempenho para jogos em 1440p e 4K, com Ray Tracing e DLSS 3.' },
                { id: 'nvidia-rtx-4090-24gb', name: 'NVIDIA RTX 4090 (24GB GDDR6X)', price: 4800, pcie_gen: 'Gen4', performance_score: 160, stock: 3, advanced_only: true, icon: 'fas fa-space-shuttle', description_advanced: 'NVIDIA GeForce RTX 4090 com 24GB GDDR6X. Performance máxima para 4K gaming, criação de conteúdo profissional e IA.' },
                { id: 'amd-rx-6500xt-4gb', name: 'AMD RX 6500 XT (4GB GDDR6)', price: 400, pcie_gen: 'Gen4', performance_score: 38, stock: 13, icon: 'fas fa-gamepad', description_advanced: 'AMD Radeon RX 6500 XT com 4GB GDDR6. Placa de entrada RDNA2 para jogos em 1080p (baixo-médio). Interface PCIe 4.0 x4.' }, 
                { id: 'amd-rx-7600-8gb', name: 'AMD RX 7600 (8GB GDDR6)', price: 950, pcie_gen: 'Gen4', performance_score: 75, stock: 9, icon: 'fas fa-gamepad', description_advanced: 'AMD Radeon RX 7600 com 8GB GDDR6. Arquitetura RDNA3. Ótima para jogos em 1080p (alto) e bom desempenho em 1440p.' },
                { id: 'amd-rx-7800xt-16gb', name: 'AMD RX 7800 XT (16GB GDDR6)', price: 1900, pcie_gen: 'Gen4', performance_score: 105, stock: 6, advanced_only: true, icon: 'fas fa-fighter-jet', description_advanced: 'AMD Radeon RX 7800 XT com 16GB GDDR6. Excelente performance em 1440p e competente em 4K. Alternativa forte para GPUs high-end.' },
                { id: 'intel-arc-a750-8gb', name: 'Intel Arc A750 (8GB GDDR6)', price: 750, pcie_gen: 'Gen4', performance_score: 62, stock: 8, icon: 'fas fa-gamepad', description_advanced: 'Intel Arc A750 com 8GB GDDR6. Boa performance em jogos 1080p/1440p, especialmente com drivers otimizados. Suporte a AV1 encoding.' }, 
                { id: 'intel-arc-a770-16gb', name: 'Intel Arc A770 (16GB GDDR6)', price: 1200, pcie_gen: 'Gen4', performance_score: 78, stock: 5, advanced_only: true, icon: 'fas fa-gamepad', description_advanced: 'Intel Arc A770 com 16GB GDDR6. Melhor GPU da Intel Arc Alchemist, boa para criação de conteúdo e jogos, com grande VRAM.' },
            ],
            display: [ 
                { id: 'disp-15fhd60', name: '15.6" FHD IPS (1920x1080, 60Hz)', price: 200, performance_score: 20, stock: 18, icon: 'fas fa-desktop', description_advanced: 'Tela de 15.6 polegadas, resolução Full HD (1920x1080), painel IPS para boas cores e ângulos de visão, taxa de atualização de 60Hz. Padrão para uso geral.' }, 
                { id: 'disp-15fhd144', name: '15.6" FHD IPS (1920x1080, 144Hz)', price: 320, performance_score: 35, stock: 15, icon: 'fas fa-desktop', description_advanced: 'Tela de 15.6" FHD IPS com alta taxa de atualização de 144Hz para maior fluidez em jogos e movimentos rápidos. Ideal para gamers.' }, 
                { id: 'disp-17qhd165', name: '17.3" QHD IPS (2560x1440, 165Hz)', price: 580, performance_score: 55, stock: 9, advanced_only: true, icon: 'fas fa-desktop', description_advanced: 'Tela maior de 17.3", resolução QHD (2.5K) para maior nitidez, painel IPS e taxa de atualização de 165Hz. Imersiva para jogos e produtividade.' },
                { id: 'disp-16oled4k60', name: '16" OLED 4K (3840x2160, 60Hz)', price: 850, performance_score: 70, stock: 6, advanced_only: true, icon: 'fas fa-palette', description_advanced: 'Tela de 16" com painel OLED para pretos perfeitos e cores vibrantes, resolução 4K UHD. Ideal para criadores de conteúdo (DCI-P3 100%). 60Hz.' },
                { id: 'disp-14touch', name: '14" FHD IPS Touchscreen (1920x1080, 60Hz)', price: 400, performance_score: 28, stock: 8, icon: 'fas fa-hand-pointer', description_advanced: 'Tela de 14" FHD IPS com funcionalidade touchscreen. Versátil para navegação e interação direta. Ideal para notebooks 2-em-1 se a carcaça for compatível.' }, 
                { id: 'disp-ultrawide-qhd', name: '15.6" QHD Ultrawide (2560x1080, 120Hz) Curva', price: 700, performance_score: 60, stock: 4, advanced_only: true, icon: 'fas fa-arrows-alt-h', description_advanced: 'Tela de 15.6" com proporção ultrawide e leve curvatura para maior imersão. Resolução QHD estendida e 120Hz. (Nota: Formato incomum para notebooks, mais conceitual).'},
                { id: 'disp-16miniled-qhd240', name: '16" Mini-LED QHD (2560x1440, 240Hz) HDR1000', price: 1100, performance_score: 85, stock: 3, advanced_only: true, icon: 'fas fa-sun', description_advanced: 'Tela de 16" QHD com retroiluminação Mini-LED para alto contraste e brilho (HDR1000). Taxa de atualização de 240Hz para máxima fluidez. Ideal para gaming HDR e profissionais de imagem.'}
            ],
            keyboard: [ 
                { id: 'kbd-membrane-br', name: 'Teclado Membrana ABNT2 Simples', price: 40, performance_score: 5, stock: 25, icon: 'fas fa-keyboard', description_advanced: 'Teclado de membrana padrão ABNT2, funcional para digitação do dia a dia. Sem retroiluminação.' }, 
                { id: 'kbd-backlit-br', name: 'Teclado Retroiluminado ABNT2 (Branco)', price: 70, performance_score: 10, stock: 18, icon: 'fas fa-keyboard', description_advanced: 'Teclado ABNT2 com retroiluminação LED na cor branca para melhor visibilidade em ambientes escuros.' }, 
                { id: 'kbd-mech-rgb-br', name: 'Teclado Mecânico RGB ABNT2 (Switch Red)', price: 160, performance_score: 22, stock: 11, icon: 'fas fa-keyboard', description_advanced: 'Teclado mecânico ABNT2 com switches lineares (ex: Red), retroiluminação RGB por tecla personalizável. Ideal para gamers e digitação responsiva.' },
                { id: 'kbd-lowprofile-rgb', name: 'Teclado Low-Profile RGB ABNT2 Silencioso', price: 200, performance_score: 18, stock: 8, advanced_only: true, icon: 'fas fa-keyboard', description_advanced: 'Teclado ABNT2 de perfil baixo, com switches mais silenciosos e atuação rápida. Retroiluminação RGB. Design elegante e confortável.' },
                { id: 'kbd-optical-gamer', name: 'Teclado Óptico Gamer RGB (Resposta Rápida)', price: 280, performance_score: 28, stock: 5, advanced_only: true, icon: 'fas fa-keyboard', description_advanced: 'Teclado ABNT2 com switches ópticos para resposta ultra-rápida (menor debounce). Retroiluminação RGB e macros programáveis. Foco em performance competitiva.' },
            ],
            os: [
                { id: 'os-deivios', name: 'Linux DeiviOS (Otimizado)', price: 70, description_basic: 'Leve, rápido e customizado para devs.', description_advanced: 'Base Debian com XFCE, focado em performance e ferramentas de desenvolvimento. Kernel otimizado. Ideal para quem busca controle e eficiência. RAM Mín: 500MB.', storage_impact: '~10GB', ram_min: '500MB', performance_score: 10, stock: 999, icon: 'fab fa-dev' },
                { id: 'os-ubuntu', name: 'Linux Ubuntu Desktop LTS', price: 0, description_basic: 'Popular, amigável e com grande suporte.', description_advanced: 'Versão LTS mais recente. Interface GNOME. Ótimo para iniciantes e usuários que buscam estabilidade e vasta comunidade. Perfis de uso podem ser aplicados.', storage_impact: '~20GB', ram_min: '2GB', performance_score: 8, stock: 999, icon: 'fab fa-ubuntu' },
                { id: 'os-mint', name: 'Linux Mint Cinnamon', price: 0, description_basic: 'Elegante, fácil de usar, codecs inclusos.', description_advanced: 'Base Ubuntu LTS, interface Cinnamon similar ao Windows. Conhecido pela facilidade de uso e codecs multimídia pré-instalados.', storage_impact: '~20GB', ram_min: '1GB', performance_score: 7, stock: 999, icon: 'fab fa-linux' }, 
                { id: 'os-fedora', name: 'Linux Fedora Workstation', price: 0, description_basic: 'Inovador, com software de ponta.', description_advanced: 'Focado em software livre e tecnologias recentes. Interface GNOME padrão. Para entusiastas e desenvolvedores que gostam de novidades.', storage_impact: '~18GB', ram_min: '2GB', performance_score: 9, stock: 999, icon: 'fab fa-fedora' },
                { id: 'os-manjaro', name: 'Linux Manjaro XFCE', price: 0, description_basic: 'Base Arch, amigável e poderoso.', description_advanced: 'Rolling release baseado no Arch Linux, mas com foco na facilidade de uso. XFCE é leve e customizável.', storage_impact: '~15GB', ram_min: '1GB', performance_score: 10, stock: 999, icon: 'fas fa-kiwi-bird' }, 
                { id: 'os-endeavouros', name: 'Linux EndeavourOS (Arch Based)', price: 0, description_basic: 'Arch Linux com instalador amigável.', description_advanced: 'Para quem quer a experiência Arch com uma instalação mais simples. Várias opções de DEs durante a instalação.', storage_impact: '~10GB + DE', ram_min: '1GB', performance_score: 11, stock: 999, icon: 'fas fa-rocket' },
                { id: 'os-win10-home', name: 'Windows 10 Home', price: 50, description_basic: 'Windows estável e conhecido.', description_advanced: 'Ideal para quem prefere a interface e compatibilidade do Windows 10. Perfis de uso (Multimídia, Gamer, Corporativo) e softwares adicionais podem ser solicitados.', storage_impact: '~30GB', ram_min: '2GB', performance_score: 4, stock: 50, icon: 'fab fa-windows' },
                { id: 'os-win11-home', name: 'Windows 11 Home', price: 50, description_basic: 'Interface moderna e novos recursos.', description_advanced: 'Suporte a DirectX 12 Ultimate, ideal para jogos e aplicações gerais. Requisitos de TPM 2.0. Perfis de uso (Multimídia, Gamer, Corporativo) e softwares adicionais podem ser solicitados.', storage_impact: '~30GB', ram_min: '4GB', performance_score: 5, stock: 60, icon: 'fab fa-windows' },
                { id: 'os-win11-pro', name: 'Windows 11 Pro', price: 80, description_basic: 'Recursos avançados para profissionais.', description_advanced: 'Inclui BitLocker, Área de Trabalho Remota, Hyper-V. Para uso corporativo e usuários avançados. Perfis de uso e softwares adicionais podem ser solicitados.', storage_impact: '~32GB', ram_min: '4GB', performance_score: 6, stock: 40, advanced_only: true, icon: 'fab fa-windows' },
                { id: 'os-chromeos-flex', name: 'ChromeOS Flex', price: 0, description_basic: 'Rápido, simples e seguro para nuvem.', description_advanced: 'Baseado na nuvem, inicialização rápida, atualizações automáticas. Perfeito para navegação e apps web em hardware mais modesto.', storage_impact: '~10GB', ram_min: '2GB', performance_score: 2, stock: 999, basic_only: true, icon: 'fab fa-chrome' },
                { id: 'os-brunch-chromeos', name: 'Brunch ChromeOS (Full)', price: 15, description_basic: 'ChromeOS com Play Store e Linux.', description_advanced: 'Framework para instalar ChromeOS em PCs genéricos, habilitando Google Play Store e ambiente Linux (Crostini). Requer mais configuração.', storage_impact: '~25GB', ram_min: '4GB', performance_score: 3, stock: 30, advanced_only: true, icon: 'fab fa-google-play' },
                { id: 'os-none', name: 'Nenhum (Traga sua licença/SO)', price: 0, description_basic: 'Você instala seu próprio SO.', description_advanced: 'Nenhum sistema operacional pré-instalado. Requer que você tenha sua própria licença e mídia de instalação. Ideal para usuários avançados ou com licenças específicas.', storage_impact: '0GB', ram_min: 'N/A', performance_score: 0, stock: 999, icon: 'fas fa-times-circle' }
            ],
            network_adapter: [ 
                { id: 'wifi5-bt4', name: 'Wi-Fi 5 + BT 4.2 Essencial', price: 55, performance_score: 5, stock: 20, icon: 'fas fa-wifi', description_basic: 'Conexão Wi-Fi AC.', description_advanced: 'Módulo Wi-Fi 802.11ac (Wi-Fi 5) Dual Band (2.4/5GHz), até 867Mbps. Bluetooth 4.2. Padrão para conectividade básica.' }, 
                { id: 'wifi6-bt5', name: 'Wi-Fi 6 + BT 5.2 Rápido', price: 100, performance_score: 10, stock: 18, icon: 'fas fa-wifi', description_basic: 'Wi-Fi AX moderno.', description_advanced: 'Módulo Wi-Fi 802.11ax (Wi-Fi 6) Dual Band, até 2.4Gbps teóricos. Bluetooth 5.2. Melhorias em latência, capacidade (OFDMA, MU-MIMO).' },
                { id: 'wifi6e-bt53', name: 'Wi-Fi 6E + BT 5.3 Avançado', price: 160, performance_score: 15, stock: 10, advanced_only: true, icon: 'fas fa-wifi', description_basic: 'Wi-Fi Tri-Band 6GHz.', description_advanced: 'Módulo Wi-Fi 6E, adiciona a banda de 6GHz para menos interferência e maior velocidade. Bluetooth 5.3. Ideal para ambientes congestionados e streaming de alta qualidade.' },
                { id: 'wifi7-bt54', name: 'Wi-Fi 7 + BT 5.4 Ultra', price: 280, performance_score: 25, stock: 5, advanced_only: true, icon: 'fas fa-satellite-dish', description_basic: 'Tecnologia de ponta Wi-Fi.', description_advanced: 'Módulo Wi-Fi 802.11be (Wi-Fi 7), com canais de 320MHz, MLO (Multi-Link Operation) para velocidades e latências ainda melhores. Bluetooth 5.4. Para quem busca o máximo em conectividade sem fio.' },
                { id: 'wifi-none', name: 'Sem Adaptador Wi-Fi', price: 0, performance_score: 0, stock: 999, icon: 'fas fa-ethernet', description_basic: 'Apenas Ethernet cabeada.', description_advanced: 'Nenhum adaptador Wi-Fi/Bluetooth será incluído. A conexão à rede será exclusivamente via porta Ethernet da placa mãe (se disponível).' }
            ],
            battery: [ 
                { id: 'bat-45wh', name: 'Bateria 45Wh (Padrão)', price: 80, performance_score: 5, stock: 20, icon: 'fas fa-battery-half', description_advanced: 'Bateria de íon-lítio com capacidade de 45 Watt-hora. Autonomia padrão para uso leve a moderado.' }, 
                { id: 'bat-60wh', name: 'Bateria 60Wh (Longa Duração)', price: 140, performance_score: 10, stock: 12, icon: 'fas fa-battery-full', description_advanced: 'Bateria de 60Wh para maior autonomia, permitindo mais tempo de uso longe da tomada. Ideal para portabilidade.' },
                { id: 'bat-75wh-pro', name: 'Bateria 75Wh (Profissional)', price: 200, performance_score: 15, stock: 8, advanced_only: true, icon: 'fas fa-battery-full', description_advanced: 'Bateria de alta capacidade (75Wh) para uso profissional prolongado ou sessões de gaming mais longas.' },
                { id: 'bat-99wh-max', name: 'Bateria 99.9Wh (Máx. Voo)', price: 260, performance_score: 20, stock: 6, advanced_only: true, icon: 'fas fa-plane-departure', description_advanced: 'Bateria de 99.9Wh, a maior capacidade permitida em voos comerciais. Máxima autonomia para quem está sempre em movimento.' },
            ],
            peripherals: [ 
                { id: 'peri-mouse-basic', name: 'Mouse Óptico Básico USB', price: 25, performance_score: 2, stock: 25, icon: 'fas fa-mouse', description: 'Mouse óptico com fio, conexão USB, 3 botões. Funcional para navegação.' },
                { id: 'peri-mouse-gamer-rgb', name: 'Mouse Gamer RGB ProSensor', price: 80, performance_score: 8, stock: 15, icon: 'fas fa-mouse-pointer', description: 'Mouse gamer com sensor de alta precisão (DPI ajustável), botões programáveis e iluminação RGB.' },
                { id: 'peri-headset-p2', name: 'Headset P2 Confort com Mic', price: 55, performance_score: 5, stock: 18, icon: 'fas fa-headset', description: 'Headset com conexão P2 (3.5mm), almofadas confortáveis e microfone para chamadas e jogos.' },
                { id: 'peri-headset-usb-71', name: 'Headset USB Gamer 7.1 Surround', price: 130, performance_score: 10, stock: 9, advanced_only: true, icon: 'fas fa-headphones-alt', description: 'Headset gamer USB com som surround virtual 7.1, microfone com cancelamento de ruído e iluminação.' },
                { id: 'peri-webcam-hd', name: 'Webcam HD 720p (Integrada/USB)', price: 60, performance_score: 4, stock: 12, icon: 'fas fa-video', description: 'Webcam com resolução HD 720p. Pode ser integrada à carcaça (se compatível) ou externa via USB.' },
                { id: 'peri-webcam-fhd-pro', name: 'Webcam Full HD 1080p Pro USB com Mic', price: 110, performance_score: 7, stock: 7, advanced_only: true, icon: 'fas fa-camera-retro', description: 'Webcam USB com resolução Full HD 1080p, foco automático e microfone embutido de melhor qualidade.' },
                { id: 'peri-hub-usbc-multi', name: 'Hub USB-C Multiportas Essencial (HDMI, USB-A)', price: 95, performance_score: 3, stock: 10, icon: 'fas fa-plug', description: 'Hub USB-C compacto com saídas HDMI, portas USB-A adicionais e, possivelmente, leitor de cartão.' },
                { id: 'peri-cooler-base-led', name: 'Base Cooler para Notebook com LED', price: 70, performance_score: 6, stock: 8, icon: 'fas fa-fan', description: 'Base refrigeradora com ventoinhas para auxiliar na dissipação de calor do notebook. Iluminação LED.' },
                { id: 'peri-mochila-nb', name: 'Mochila Acolchoada para Notebook até 17"', price: 120, performance_score: 1, stock: 11, icon: 'fas fa-briefcase', description: 'Mochila com compartimento acolchoado para proteger notebooks de até 17 polegadas. Múltiplos bolsos.' },
                { id: 'peri-ssd-externo-500gb', name: 'SSD Externo USB 3.2 500GB Portátil', price: 220, performance_score: 9, stock: 6, icon: 'fas fa-external-link-square-alt', description: 'Unidade SSD externa de 500GB com conexão USB 3.2 para transferências rápidas. Portátil e resistente.' },
            ]
        }; 
        
         const softwareCategories = {
            multimedia: [
                { id: 'sw-vlc', name: 'VLC Media Player', price: 0, description: 'Reprodutor multimídia versátil, suporta quase todos os formatos.', icon: 'fas fa-play-circle', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                { id: 'sw-spotify', name: 'Spotify Desktop', price: 0, description: 'Cliente desktop para streaming de música.', icon: 'fab fa-spotify', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-ubuntu', 'os-mint', 'os-fedora'], stock: 999 },
                { id: 'sw-kodi', name: 'Kodi Media Center', price: 0, description: 'Software de media center de código aberto.', icon: 'fas fa-tv', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint'], stock: 999 },
                { id: 'sw-netflix-app', name: 'App Netflix (Windows)', price: 0, description: 'App da loja para Netflix (requer assinatura).', icon: 'fas fa-film', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro'], stock: 999 },
            ],
            design: [
                { id: 'sw-gimp', name: 'GIMP', price: 0, description: 'Editor de imagens poderoso, alternativa ao Photoshop.', icon: 'fas fa-paint-brush', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                { id: 'sw-blender', name: 'Blender', price: 0, description: 'Suíte de criação 3D: modelagem, animação, renderização.', icon: 'fas fa-cube', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                { id: 'sw-krita', name: 'Krita', price: 0, description: 'Software de pintura digital profissional e gratuito.', icon: 'fas fa-palette', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora'], stock: 999 },
                { id: 'sw-davinciresolve', name: 'DaVinci Resolve (Grátis)', price: 0, description: 'Editor de vídeo profissional com correção de cor avançada.', stock: 999, icon: 'fas fa-video', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-ubuntu', 'os-mint', 'os-fedora'] },
                { id: 'sw-inkscape', name: 'Inkscape', price: 0, description: 'Editor de gráficos vetoriais de código aberto.', icon: 'fas fa-vector-square', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora'], stock: 999 },
            ],
            development: [
                { id: 'sw-vscode', name: 'VS Code', price: 0, description: 'Editor de código fonte popular e extensível.', icon: 'fas fa-code', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                { id: 'sw-git', name: 'Git SCM', price: 0, description: 'Sistema de controle de versão distribuído.', icon: 'fab fa-git-alt', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                { id: 'sw-docker', name: 'Docker Desktop', price: 0, description: 'Plataforma de contêineres Light (pode requerer Pro no Windows).', icon: 'fab fa-docker', os_req: ['os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora'], stock: 999 },
                { id: 'sw-python', name: 'Python (Última Versão)', price: 0, description: 'Linguagem de programação Python e pip.', icon: 'fab fa-python', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                { id: 'sw-nodejs', name: 'Node.js (LTS)', price: 0, description: 'Ambiente de execução JavaScript (Node.js e npm).', icon: 'fab fa-node-js', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
            ],
            productivity: [ // Changed from productivity/corp to productivity/Outros based on target UI
                 { id: 'sw-libreoffice', name: 'LibreOffice Suite', price: 0, description: 'Alternativa gratuita e de código aberto ao Microsoft Office.', icon: 'fas fa-file-alt', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                 { id: 'sw-office365-personal-trial', name: 'Microsoft 365 Personal (Trial 1 Mês)', price: 20, description: 'Word, Excel, PowerPoint, Outlook. Requer ativação.', icon: 'fas fa-file-word', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro'], stock: 999 },
                 { id: 'sw-msoffice-home-student-2021', name: 'Microsoft Office Home & Student 2021', price: 350, description: 'Word, Excel, PowerPoint (Licença Perpétua).', icon: 'fas fa-user-graduate', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro'], stock: 20 },
                 { id: 'sw-qbittorrent', name: 'qBittorrent', price: 0, description: 'Cliente BitTorrent leve, rápido e sem anúncios.', icon: 'fas fa-cloud-download-alt', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
                 { id: 'sw-7zip', name: '7-Zip', price: 0, description: 'Compactador/Descompactador de arquivos gratuito.', icon: 'fas fa-file-archive', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora'], stock: 999 },
                 { id: 'sw-powertoys', name: 'Microsoft PowerToys (Windows)', price: 0, description: 'Conjunto de utilitários para customização e produtividade.', icon: 'fas fa-tools', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro'], stock: 999 },
                 { id: 'sw-steam', name: 'Steam Client', price: 0, description: 'Plataforma de jogos digitais.', icon: 'fab fa-steam', os_req: ['os-win10-home', 'os-win11-home', 'os-win11-pro', 'os-deivios', 'os-ubuntu', 'os-mint', 'os-fedora', 'os-manjaro', 'os-endeavouros'], stock: 999 },
            ]
        };

        const services = [
            { 
                id: 'serv-os-install-win', name: 'Instalação Windows (Home/Pro)', basePrice: 80, 
                description: 'Instalação limpa do Windows 10 ou 11 (licença não inclusa se não adquirida conosco). Inclui drivers básicos e otimizações.',
                details: `<strong>Procedimento:</strong><br>1. Backup de dados (se aplicável, cobrado à parte).<br>2. Formatação da unidade de destino.<br>3. Instalação do Windows a partir de mídia oficial.<br>4. Instalação de drivers essenciais da placa-mãe e componentes.<br>5. Otimizações básicas (inicialização, serviços).<br>6. Ativação do Windows (com chave do cliente ou adquirida).<br><i>Perfis de uso (Multimídia +R$30, Gamer +R$40, Corporativo +R$50) podem ser adicionados.</i>`,
                icon: 'fab fa-windows'
            },
            { 
                id: 'serv-os-install-linux', name: 'Instalação Linux (Ubuntu, Mint, DeiviOS etc.)', basePrice: 70, 
                description: 'Instalação da sua distribuição Linux preferida, com ambiente desktop padrão e drivers.',
                details: `<strong>Procedimento:</strong><br>1. Backup de dados (se aplicável).<br>2. Particionamento adequado (manual ou automático).<br>3. Instalação da distribuição Linux escolhida.<br>4. Configuração de drivers e repositórios.<br>5. Instalação de codecs e apps básicos (se solicitado).<br><i>Dual boot com Windows existente: +R$40.</i>`,
                icon: 'fab fa-linux' 
            },
            {
                id: 'serv-ram-upgrade', name: 'Upgrade de Memória RAM', basePrice: 50,
                description: 'Instalação de novos módulos de RAM (custo do(s) módulo(s) de RAM não incluso).',
                details: `<strong>Procedimento:</strong><br>1. Verificação de compatibilidade (tipo DDR, velocidade, capacidade máxima).<br>2. Abertura segura do notebook.<br>3. Instalação dos novos módulos de RAM nos slots corretos.<br>4. Teste de reconhecimento e estabilidade.<br><u>Custo da RAM a ser adicionado</u>. Ex: 8GB DDR4 ~R$100-150. 16GB DDR5 ~R$200-300. Valores variam.`,
                icon: 'fas fa-memory'
            },
            {
                id: 'serv-storage-upgrade', name: 'Upgrade de Armazenamento (HDD p/ SSD/NVMe)', basePrice: 70,
                description: 'Substituição ou adição de SSD/NVMe (custo do dispositivo não incluso). Clonagem opcional.',
                details: `<strong>Procedimento:</strong><br>1. Verificação de compatibilidade (SATA, M.2 NVMe/SATA, PCIe Gen).<br>2. Opcional: Clonagem do sistema antigo para o novo SSD (+R$50, se viável tecnicamente).<br>3. Instalação física do novo SSD/NVMe.<br>4. Formatação e inicialização (se instalação limpa) ou verificação da clonagem.<br><u>Custo do SSD/NVMe a ser adicionado</u>. Ex: SSD SATA 1TB ~R$250. NVMe 1TB Gen4 ~R$350. Valores variam.`,
                icon: 'fas fa-hdd'
            },
            {
                id: 'serv-wifi-upgrade', name: 'Upgrade de Adaptador Wi-Fi/Bluetooth', basePrice: 60,
                description: 'Substituição do módulo Wi-Fi/BT por um mais moderno (custo do módulo não incluso).',
                details: `<strong>Procedimento:</strong><br>1. Identificação do módulo atual e compatibilidade do slot (geralmente M.2 A+E Key).<br>2. Remoção cuidadosa do módulo antigo e suas antenas.<br>3. Instalação do novo módulo e reconexão das antenas.<br>4. Instalação de drivers e teste de conexão.<br><u>Custo do módulo a ser adicionado</u>. Ex: Wi-Fi 6/BT5.2 ~R$100-180. Valores variam.`,
                icon: 'fas fa-wifi'
            },
             {
                id: 'serv-internal-cleaning', name: 'Limpeza Interna de Componentes + Pasta Térmica', basePrice: 90,
                description: 'Limpeza de poeira em coolers, dissipadores e placa mãe. Troca de pasta térmica (CPU/GPU).',
                details: `<strong>Procedimento:</strong><br>1. Abertura segura do notebook.<br>2. Remoção de poeira acumulada com ar comprimido e pincéis antiestáticos.<br>3. Limpeza de ventoinhas e saídas de ar.<br>4. Remoção da pasta térmica antiga de CPU e GPU.<br>5. Aplicação de nova pasta térmica de qualidade (ex: Arctic MX-4 ou similar).<br>6. Remontagem e teste de temperaturas.`,
                icon: 'fas fa-broom'
            },
            {
                id: 'serv-data-backup', name: 'Backup de Dados (até 500GB)', basePrice: 80,
                description: 'Backup de seus arquivos pessoais para mídia externa ou nuvem (mídia/armazenamento não incluso).',
                details: `<strong>Procedimento:</strong><br>1. Identificação das pastas e arquivos a serem backupeados (Ex: Documentos, Imagens, Desktop).<br>2. Cópia dos dados para um HD externo do cliente ou para novo dispositivo.<br>3. Verificação básica da integridade do backup.<br>Para volumes maiores ou backup de sistema completo (imagem), valor sob consulta.`,
                icon: 'fas fa-save'
            },
            {
                id: 'serv-consultancy', name: 'Consultoria e Diagnóstico Completo Avançado', basePrice: 120,
                description: 'Análise profunda, testes de stress, identificação de gargalos, relatório detalhado e plano de otimização/upgrade.',
                details: `<strong>Inclui:</strong><br>1. Entrevista para entender necessidades e problemas.<br>2. Testes de hardware (CPU, GPU, RAM, Storage, Temperaturas).<br>3. Análise de software e performance do sistema.<br>4. Identificação de gargalos e possíveis falhas.<br>5. Relatório com diagnóstico e sugestões personalizadas.<br><i>Valor pode ser parcialmente abatido em serviços/produtos adquiridos no mesmo atendimento.</i>`,
                icon: 'fas fa-stethoscope'
            },
            {
                id: 'serv-iptv-test', name: 'Solicitar Teste IPTV Grátis (7 dias)', basePrice: 0,
                description: 'Experimente nosso serviço de IPTV parceiro por 7 dias. Sujeito à disponibilidade e termos.',
                details: `<strong>Como funciona:</strong><br>1. Após selecionar este "serviço", entraremos em contato via WhatsApp.<br>2. Forneceremos as credenciais e instruções para o teste.<br>3. O teste é válido por 7 dias corridos.<br>4. Requer aplicativo compatível (ex: para SmartTV, Celular, TV Box) e boa conexão de internet.<br><i>Este é um teste sem compromisso de um serviço parceiro. A DeiviTech não se responsabiliza pelo conteúdo ou estabilidade do serviço de IPTV.</i>`,
                icon: 'fas fa-tv-alt' // Specific IPTV icon from Font Awesome: fas fa-tv-alt / fas fa-satellite-dish
            }
        ];
        
        const qualityPresets = { 
            0: { 
                name: 'Econômico', platform: 'intel', casing: 'casing-eco', motherboard: 'intel-h610m', cpu: 'intel-i3-13100f',
                ram_type: 'ddr4-8gb-3200-1pk', ram_quantity: 1, storage1_type: 'sata-ssd-500gb', storage2_type: 'none',
                gpu: 'integrated', display: 'disp-15fhd60', keyboard: 'kbd-membrane-br', battery: 'bat-45wh',
                os: 'os-deivios', network_adapter: 'wifi5-bt4', peripherals: [], software: ['sw-libreoffice', 'sw-vlc'], mode_target: 'basic'
            },
            1: { 
                name: 'Balanceado', platform: 'amd', casing: 'casing-silverstone', motherboard: 'amd-b650m-plus-wifi', cpu: 'amd-r5-7500f',
                ram_type: 'ddr5-16gb-5200-1pk', ram_quantity: 1, storage1_type: 'nvme-gen4-1tb', storage2_type: 'none',
                gpu: 'nvidia-rtx-3050-6gb', display: 'disp-15fhd144', keyboard: 'kbd-backlit-br', battery: 'bat-60wh',
                os: 'os-win11-home', network_adapter: 'wifi6-bt5', peripherals: ['peri-mouse-gamer-rgb'], software: ['sw-libreoffice', 'sw-vlc', 'sw-steam'], mode_target: 'basic'
            },
            2: { 
                name: 'Performance', platform: 'intel', casing: 'casing-gamer-rgb', motherboard: 'intel-z790-pro-wifi', cpu: 'intel-i7-14700k',
                ram_type: 'ddr5-32gb-5600-2pk', ram_quantity: 1, storage1_type: 'nvme-gen5-1tb', storage2_type: 'nvme-gen4-1tb',
                gpu: 'nvidia-rtx-4070ti-12gb', display: 'disp-17qhd165', keyboard: 'kbd-mech-rgb-br', battery: 'bat-75wh-pro',
                os: 'os-win11-pro', network_adapter: 'wifi6e-bt53', peripherals: ['peri-mouse-gamer-rgb', 'peri-headset-usb-71'], software: ['sw-steam', 'sw-davinciresolve', 'sw-blender', 'sw-office365-personal-trial'], mode_target: 'advanced'
            }
        };

        const readyNotebooks = [
            {
                id: 'ready-office-basic', name: 'DeiviTech OfficeStart Linux', hardwarePrice: 310, defaultOsId: 'os-deivios', 
                image: 'https://placehold.co/300x200/7f8c8d/ffffff?text=OfficeStart',
                specs: { platform: 'intel', casing: 'casing-eco', motherboard: 'intel-h610m', cpu: 'intel-i3-13100f', ram_type: 'ddr4-8gb-3200-1pk', ram_quantity: 1, storage1: 'sata-ssd-500gb', gpu: 'integrated', display: 'disp-15fhd60', keyboard: 'kbd-membrane-br', battery: 'bat-45wh', network_adapter: 'wifi5-bt4' },
                description: "Notebook básico e eficiente para estudos e trabalho com Linux. SSD para agilidade."
            },
            {
                id: 'ready-student-plus-win', name: 'DeiviTech StudentPlus Windows', hardwarePrice: 1600, defaultOsId: 'os-win11-home', 
                image: 'https://placehold.co/300x200/2ecc71/ffffff?text=StudentPlus',
                specs: { platform: 'amd', casing: 'casing-silverstone', motherboard: 'amd-a620m', cpu: 'amd-r5-7500f', ram_type: 'ddr5-16gb-5200-1pk', ram_quantity: 1, storage1: 'nvme-gen3-512gb', gpu: 'integrated', display: 'disp-15fhd60', keyboard: 'kbd-backlit-br', battery: 'bat-60wh', network_adapter: 'wifi6-bt5'},
                description: "Ideal para estudantes: Portátil, bom desempenho com Ryzen 5, SSD NVMe e Windows 11 Home. Tela Full HD e teclado retroiluminado."
            },
             {
                id: 'ready-devmaster-linux', name: 'DeiviTech DevMaster Linux', hardwarePrice: 2780, defaultOsId: 'os-deivios',
                image: 'https://placehold.co/300x200/1abc9c/ffffff?text=DevMaster+Linux',
                specs: { platform: 'amd', casing: 'casing-pro-alum', motherboard: 'amd-b650m-plus-wifi', cpu: 'amd-r7-8700g', ram_type: 'ddr5-32gb-5600-2pk', ram_quantity: 1, storage1: 'nvme-gen4-1tb', gpu: 'integrated', display: 'disp-15fhd144', keyboard: 'kbd-backlit-br', battery: 'bat-60wh', network_adapter: 'wifi6e-bt53' },
                description: "Potência e leveza para desenvolvedores Linux. CPU AMD Ryzen com NPU, 32GB RAM DDR5 e SSD NVMe rápido. Tela Full HD 144Hz e DeiviOS otimizado."
            },
            {
                id: 'ready-gamer-rtx4060', name: 'DeiviTech GamerBlast RTX4060', hardwarePrice: 4250, defaultOsId: 'os-win11-home',
                image: 'https://placehold.co/300x200/e74c3c/ffffff?text=GamerBlast+4060',
                specs: { platform: 'intel', casing: 'casing-gamer-rgb', motherboard: 'intel-b760m-wifi', cpu: 'intel-i5-14400f', ram_type: 'ddr4-16gb-3200-2pk', ram_quantity: 1, storage1: 'nvme-gen4-1tb', gpu: 'nvidia-rtx-4060-8gb', display: 'disp-15fhd144', keyboard: 'kbd-mech-rgb-br', battery: 'bat-60wh', network_adapter: 'wifi6-bt5'},
                description: "Domine seus jogos com a RTX 4060 e CPU Intel de 14ª geração. 16GB RAM, SSD NVMe veloz e tela 144Hz para uma experiência fluida."
            },
            { 
                id: 'ready-ultralight-copilot', name: 'DeiviTech Air Copilot+', hardwarePrice: 1500, defaultOsId: 'os-win11-home', // Hardware price is mobo + chip + ram etc.
                image: 'https://placehold.co/300x200/3498db/ecf0f1?text=Air+Copilot%2B',
                specs: { platform: 'arm', casing: 'casing-ultrabook-mag', motherboard: 'custom-arm-copilot', cpu: 'snapdragon-x-elite', ram_type: 'lpddr5x-16gb', ram_quantity: 1, storage1: 'nvme-gen4-512gb', gpu: 'adreno-copilot', display: 'disp-14touch', keyboard: 'kbd-lowprofile-rgb', battery: 'bat-75wh-pro', network_adapter: 'wifi7-bt54' },
                description: "O futuro da computação móvel com Snapdragon X Elite e NPU. Ultraleve, bateria de longa duração e Windows 11 otimizado para IA. (Modelo conceitual)"
            }
        ];


        // HELPER FUNCTIONS
        const formatPrice = (price) => `R$ ${Number(price).toFixed(2).replace('.', ',')}`;
        
        const getComponentById = (category, id) => {
            if (!id || id === 'none' || id === 'peri-none') return null;
            if (category === 'software') {
                for (const softCat in softwareCategories) {
                    const found = softwareCategories[softCat].find(s => s.id === id);
                    if (found) return found;
                }
                return null;
            }
            return components[category]?.find(c => c.id === id) || null;
        };
        
        const getComponentPrice = (category, id) => {
             const comp = getComponentById(category, id);
             if (comp && comp.hasOwnProperty('price')) return comp.price; // Check if price property exists
             return 0; // Return 0 if no price is found (e.g. for conceptual or bundled items)
        };
        const getServiceById = (id) => services.find(s => s.id === id);
        const getServicePrice = (id) => getServiceById(id)?.basePrice || 0;

        const getComponentDescription = (item, mode) => {
            if (!item) return 'N/A';
            const desc = mode === 'basic' ? (item.description_basic || item.description || item.description_advanced) : (item.description_advanced || item.description || item.description_basic); 
            return desc || 'Descrição não disponível.';
        };

        const isComponentVisible = (item, mode, currentPlatform) => { // currentPlatform is mostly for motherboards at this stage
            if (!item) return false;
            
            // Platform filtering for motherboard is handled in getFilteredOptions.
            // This function's main role for visibility is basic/advanced mode.
            const showInBasic = item.basic_only === true;
            const showInAdvanced = item.advanced_only === true;

            if (mode === 'basic') {
                // If it's specifically for basic OR if it's not specified for basic/advanced (general component)
                // AND it's not advanced_only
                return (showInBasic || (!showInBasic && !showInAdvanced)) && !showInAdvanced;
            }
            if (mode === 'advanced') {
                // Show if it's advanced_only OR if it's not specified for basic/advanced (general component)
                // OR if it's not basic_only (advanced users can see basic components too)
                return true; // Simplification: Advanced mode sees everything
            }
            // Fallback for an unknown mode (should not happen)
            return !showInBasic && !showInAdvanced; 
        };


        // CORE LOGIC FUNCTIONS
        function showTab(tabName) {
            activeTab = tabName;
            ['configure', 'ready', 'tradein', 'services', 'specific-budget'].forEach(id => {
                const contentEl = document.getElementById(`${id}-tab-content`);
                const tabBtnEl = document.getElementById(`tab-${id}`);
                if (contentEl) contentEl.style.display = tabName === id ? 'block' : 'none';
                if (tabBtnEl) {
                    if (tabBtnEl.classList.contains('advanced-mode-tab') && !tabBtnEl.classList.contains('functional')) {
                        // Do not toggle active for non-functional advanced tabs
                    } else {
                        tabBtnEl.classList.toggle('active', tabName === id);
                    }
                }
            });
            if(tabName === 'ready') populateReadyNotebooks();
            if(tabName === 'services') populateServices();
            if(tabName === 'configure') {
                populateOptions(); 
                populateDetailedSoftwareOptions();
            }
            if(['configure', 'ready', 'tradein', 'services', 'specific-budget'].includes(tabName)) {
                 setTimeout(observeSections, 100); 
            }
        }
        
        function populateReadyNotebooks() {
            const container = document.getElementById('ready-notebooks-container');
            container.innerHTML = '';
            readyNotebooks.forEach(nb => {
                const card = document.createElement('div');
                card.className = 'ready-notebook-card card flex flex-col justify-between';
                
                let specsHtml = '<ul class="text-xs space-y-1 mt-2 mb-3 list-disc list-inside">';
                if(nb.specs.cpu) specsHtml += `<li><strong>CPU:</strong> ${getComponentById('cpu', nb.specs.cpu)?.name || nb.specs.cpu}</li>`;
                if(nb.specs.ram_type) {
                    const ramComp = getComponentById('ram', nb.specs.ram_type);
                    specsHtml += `<li><strong>RAM:</strong> ${ramComp ? ramComp.name : nb.specs.ram_type}</li>`;
                }
                if(nb.specs.gpu) specsHtml += `<li><strong>GPU:</strong> ${getComponentById('gpu', nb.specs.gpu)?.name || nb.specs.gpu}</li>`;
                if(nb.specs.storage1) specsHtml += `<li><strong>Armazen.:</strong> ${getComponentById('storage', nb.specs.storage1)?.name || nb.specs.storage1}</li>`;
                if(nb.specs.display) specsHtml += `<li><strong>Tela:</strong> ${getComponentById('display', nb.specs.display)?.name || nb.specs.display}</li>`;
                
                const defaultOsInfo = getComponentById('os', nb.defaultOsId);
                const defaultOsPrice = defaultOsInfo ? defaultOsInfo.price : 0;
                const initialTotalPrice = nb.hardwarePrice + defaultOsPrice;

                specsHtml += `<li><strong>SO Padrão:</strong> ${defaultOsInfo?.name || nb.defaultOsId}</li>`;
                specsHtml += '</ul>';

                let osSelectorHtml = `<div class="mt-2 mb-3">
                    <label for="ready-os-${nb.id}" class="block text-sm font-medium text-[var(--color-text-card)] mb-1">Sistema Operacional:</label>
                    <select id="ready-os-${nb.id}" data-notebook-id="${nb.id}" data-hardware-price="${nb.hardwarePrice}" data-default-os-price="${defaultOsPrice}" class="ready-notebook-os-select block w-full custom-select text-sm">`;
                
                components.os.forEach(os => {
                    if (os.id !== 'os-none') {
                        const osHardwareTotal = nb.hardwarePrice + os.price;
                        let priceDiffIndicator = "";
                        if (os.price > defaultOsPrice) priceDiffIndicator = ` (+${formatPrice(os.price - defaultOsPrice)})`;
                        else if (os.price < defaultOsPrice) priceDiffIndicator = ` (-${formatPrice(defaultOsPrice - os.price)})`;
                        
                        osSelectorHtml += `<option value="${os.id}" data-total-price="${osHardwareTotal}" ${os.id === nb.defaultOsId ? 'selected' : ''}>
                            ${os.name}${priceDiffIndicator}
                        </option>`;
                    }
                });
                osSelectorHtml += `</select></div>`;

                card.innerHTML = `
                     <div class="flex-grow flex flex-col"> <!-- Ensure card content can grow -->
                        <div class="flex justify-between items-start mb-2"> <!-- Image and Title Row -->
                            <img src="${nb.image}" alt="${nb.name}" class="w-2/5 h-auto object-cover rounded-md mr-3">
                            <div class="flex-grow">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-xl font-bold text-[var(--color-primary)] mb-1">${nb.name}</h3>
                                    <a href="#" onclick="alert('Vídeo demonstrativo em breve!'); return false;" title="Ver vídeo do notebook em funcionamento (em breve)">
                                        <i class="fas fa-video text-xl text-[var(--color-primary)] hover:text-[var(--color-primary-hover)]"></i>
                                    </a>
                                </div>
                                <p class="text-sm text-gray-600 body.dark-mode:text-gray-400 min-h-[50px]">${nb.description}</p>
                            </div>
                        </div>
                        <div class="flex-grow"> <!-- Specs and OS selector, allowing it to take space -->
                            ${specsHtml}
                            ${osSelectorHtml}
                        </div>
                    </div>
                    <div class="mt-auto pt-3"> <!-- Ensure this is at the bottom -->
                        <p class="text-2xl font-bold text-[var(--color-secondary)] text-center mb-3" id="price-display-${nb.id}">${formatPrice(initialTotalPrice)}</p>
                        <button class="btn btn-secondary w-full" onclick="selectReadyNotebook('${nb.id}')">Ver Detalhes e Encomendar</button>
                    </div>
                `;
                container.appendChild(card);
                observer.observe(card); 

                document.getElementById(`ready-os-${nb.id}`).addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const newTotalPrice = parseFloat(selectedOption.dataset.totalPrice);
                    document.getElementById(`price-display-${this.dataset.notebookId}`).textContent = formatPrice(newTotalPrice);
                });
                document.getElementById(`ready-os-${nb.id}`).dispatchEvent(new Event('change'));
            });
        }

        function selectReadyNotebook(notebookId) {
            const nb = readyNotebooks.find(n => n.id === notebookId);
            if (!nb) return;

            const osSelectEl = document.getElementById(`ready-os-${notebookId}`);
            const selectedOsId = osSelectEl.value;
            const selectedOsOption = osSelectEl.options[osSelectEl.selectedIndex];
            const finalPrice = parseFloat(selectedOsOption.dataset.totalPrice);

            selectedPlatform = null;
            Object.keys(selectedComponents).forEach(cat => {
                if (cat === 'ram') selectedComponents.ram = { type: null, quantity: 1 };
                else if (cat === 'storage1') selectedComponents.storage1 = { type: null };
                else if (cat === 'storage2') selectedComponents.storage2 = { type: 'none' };
                else if (cat === 'peripherals' || cat === 'software') selectedComponents[cat] = [];
                else selectedComponents[cat] = null;
            });

            selectedPlatform = nb.specs.platform;
            selectedComponents.platform = nb.specs.platform;
            Object.keys(nb.specs).forEach(specCat => {
                if (nb.specs.hasOwnProperty(specCat)) {
                    if (specCat === 'ram_type') {
                        selectedComponents.ram.type = nb.specs.ram_type;
                        selectedComponents.ram.quantity = nb.specs.ram_quantity || 1;
                    } else if (specCat === 'storage1') {
                        selectedComponents.storage1.type = nb.specs.storage1;
                    } else if (selectedComponents.hasOwnProperty(specCat)) {
                        selectedComponents[specCat] = nb.specs[specCat];
                    }
                }
            });
            selectedComponents.os = selectedOsId; 
            
            currentPresetName = `Pronto: ${nb.name} (${getComponentById('os', selectedOsId)?.name})`;
            document.getElementById('current-preset-display').textContent = `Preset Ativo: ${currentPresetName}`;
            
            showTab('configure'); 
            populateOptions(); 
            populateDetailedSoftwareOptions();
            updateVisualSelections(); 
            updateTotal(); 
            
            window.scrollTo({ top: document.getElementById('quality-slider-section').offsetTop - 20, behavior: 'smooth' });
            
            openOrderModalForReadyNotebook(nb, selectedOsId, finalPrice);
        }
        
        function openOrderModalForReadyNotebook(notebook, finalOsId, finalPrice) {
            const modalTitleEl = document.getElementById('modal-title');
            const modalMessageContentEl = document.getElementById('modal-message-content');
            const modalOrderSummaryEl = document.getElementById('modal-order-summary');
            const modalTotalPriceEl = document.getElementById('modal-total-price');
            const orderModal = document.getElementById('order-modal');

            modalTitleEl.textContent = `Encomendar Notebook Pronto: ${notebook.name}`;
            modalMessageContentEl.innerHTML = `<p>Você selecionou o notebook pronto <strong>${notebook.name}</strong> com <strong>${getComponentById('os', finalOsId)?.name || finalOsId}</strong>. Verifique os detalhes abaixo.</p>`;
            
            let summaryHtml = `<strong>Configuração Principal:</strong><br>`;
            const specs = notebook.specs;
            const getCompName = (cat, id) => getComponentById(cat, id)?.name || id || 'N/A';

            summaryHtml += `* Plataforma: ${getCompName('platform', specs.platform)}<br>`;
            summaryHtml += `* Carcaça: ${getCompName('casing', specs.casing)}<br>`;
            summaryHtml += `* Placa Mãe: ${getCompName('motherboard', specs.motherboard)}<br>`;
            summaryHtml += `* CPU: ${getCompName('cpu', specs.cpu)}<br>`;
            summaryHtml += `* RAM: ${specs.ram_quantity || 1}x ${getCompName('ram', specs.ram_type)}<br>`;
            summaryHtml += `* Armazenamento: ${getCompName('storage', specs.storage1)}<br>`;
            summaryHtml += `* GPU: ${getCompName('gpu', specs.gpu)}<br>`;
            summaryHtml += `* Tela: ${getCompName('display', specs.display)}<br>`;
            summaryHtml += `* Teclado: ${getCompName('keyboard', specs.keyboard)}<br>`;
            summaryHtml += `* SO: ${getCompName('os', finalOsId)} (Selecionado)<br>`;
            summaryHtml += `* Rede: ${getCompName('network_adapter', specs.network_adapter)}<br>`;
            summaryHtml += `* Bateria: ${getCompName('battery', specs.battery)}<br>`;
            
            modalOrderSummaryEl.innerHTML = summaryHtml;
            modalTotalPriceEl.textContent = formatPrice(finalPrice);
            orderModal.style.display = 'flex';

            let sendToWhatsAppButton = orderModal.querySelector('#send-whatsapp-btn');
            if (sendToWhatsAppButton) sendToWhatsAppButton.remove(); 

            sendToWhatsAppButton = document.createElement('button');
            sendToWhatsAppButton.id = 'send-whatsapp-btn';
            sendToWhatsAppButton.className = 'mt-4 w-full btn btn-primary flex items-center justify-center';
            sendToWhatsAppButton.innerHTML = '<i class="fab fa-whatsapp mr-2"></i> Confirmar e Enviar para WhatsApp';
            
            const modalCloseButtonEl = document.getElementById('modal-close-button'); // Renamed to avoid conflict with var name.
            modalCloseButtonEl.parentNode.insertBefore(sendToWhatsAppButton, modalCloseButtonEl);

            sendToWhatsAppButton.onclick = () => {
                let message = `Olá DeiviTech! Gostaria de solicitar um orçamento para o Notebook Pronto:\n\n`;
                message += `*MODELO: ${notebook.name}*\n\n`;
                message += `*ESPECIFICAÇÕES PRINCIPAIS (com SO selecionado):*\n`;
                message += summaryHtml.replace(/<br>/g, '\n').replace(/<strong>(.*?)<\/strong>/g, '*$1*');
                message += `\n*PREÇO TOTAL: ${formatPrice(finalPrice)}*\n\n`;
                message += `Aguardo o contato!`;
                const whatsappUrl = `https://wa.me/5575981231019?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                orderModal.style.display = 'none';
            };
        }
        
        function calculateTotalPerformance() {
            let totalScore = 0;
            const weights = { cpu: 0.25, gpu: 0.30, ram: 0.15, storage1: 0.12, motherboard: 0.03, display: 0.03, os: 0.02, network_adapter: 0.02, casing:0.01, battery:0.01, npu_bonus: 0.06 };
            let hasNPU = false;
            let powerProfileScore = 0; 

            const addScore = (category, selectedId, quantity = 1) => {
                const item = getComponentById(category, selectedId);
                if (item && item.performance_score) {
                    if (weights[category]) totalScore += (item.performance_score * quantity) * weights[category];
                    if (item.npu) hasNPU = true;
                    if (['cpu', 'gpu', 'display', 'battery'].includes(category)) {
                         powerProfileScore += item.performance_score * (weights[category] || 0.01);
                    }
                }
            };
            
            addScore('cpu', selectedComponents.cpu);
            addScore('gpu', selectedComponents.gpu);
            addScore('ram', selectedComponents.ram.type, selectedComponents.ram.quantity);
            addScore('storage1', selectedComponents.storage1.type);
            addScore('motherboard', selectedComponents.motherboard);
            addScore('display', selectedComponents.display);
            addScore('os', selectedComponents.os);
            addScore('network_adapter', selectedComponents.network_adapter);
            addScore('casing', selectedComponents.casing);
            addScore('battery', selectedComponents.battery);

            if (hasNPU) {
                const cpuComp = getComponentById('cpu', selectedComponents.cpu);
                const npuCapableScore = cpuComp ? cpuComp.performance_score : 50; // Default if CPU not found
                totalScore += npuCapableScore * weights.npu_bonus;
            }
            
            const maxTheoreticalScore = 155; 
            let percentage = (totalScore / maxTheoreticalScore) * 100;
            percentage = Math.min(Math.max(Math.round(percentage), 0), 100); // Round before clamping

            const bar = document.getElementById('performance-bar');
            const barTextDisplay = document.getElementById('performance-text-display');
            bar.style.width = `${percentage}%`;
            
            let performanceTier = "Entrada";
            if (percentage >= 90) { bar.style.backgroundColor = 'var(--color-secondary)'; performanceTier = "Monstro!";} 
            else if (percentage >= 75) { bar.style.backgroundColor = '#20BF6B'; performanceTier = "Extremo!"; } /* Dark Green */
            else if (percentage >= 60) { bar.style.backgroundColor = 'var(--color-accent-yellow)'; performanceTier = "Alto Desempenho"; } 
            else if (percentage >= 40) { bar.style.backgroundColor = '#F7B731'; performanceTier = "Intermediário"; } /* Orange-Yellow */
            else if (percentage > 0) { bar.style.backgroundColor = 'var(--color-accent-red)'; performanceTier = "Entrada"; }
            else {bar.style.backgroundColor = 'transparent'; performanceTier = "Indefinido";}


            bar.textContent = `${percentage}%`;
            barTextDisplay.textContent = `Nível: ${performanceTier}`;

            const energyDisplay = document.getElementById('energy-tendency-display');
            if (selectedComponents.cpu || selectedComponents.gpu || selectedComponents.battery){ // Only show if core components influencing power are selected
                if (powerProfileScore > 30) { energyDisplay.innerHTML = `Tendência de Energia: <span style="color:var(--color-accent-red);">Alta</span> <i class="fas fa-bolt"></i>`; }
                else if (powerProfileScore > 15) { energyDisplay.innerHTML = `Tendência de Energia: <span style="color:var(--color-accent-yellow);">Moderada</span> <i class="fas fa-leaf"></i>`; }
                else { energyDisplay.innerHTML = `Tendência de Energia: <span style="color:var(--color-secondary);">Baixa</span> <i class="fas fa-battery-quarter"></i>`; }
            } else {
                 energyDisplay.innerHTML = `Tendência de Energia: -`;
            }
        }

        function applyQualityPreset(presetValue) {
            const preset = qualityPresets[presetValue];
            if (!preset) return;

            currentPresetName = preset.name;
            document.getElementById('current-preset-display').textContent = `Preset Ativo: ${currentPresetName}`;

            if (preset.mode_target && preset.mode_target !== currentMode) {
                currentMode = preset.mode_target;
                document.getElementById('basic-mode-btn').classList.toggle('active', currentMode === 'basic');
                document.getElementById('advanced-mode-btn').classList.toggle('active', currentMode === 'advanced');
                toggleAdvancedModeTabs();
            }
            
            selectedPlatform = null; 
            Object.keys(selectedComponents).forEach(cat => {
                if (cat === 'ram') selectedComponents.ram = { type: null, quantity: 1 };
                else if (cat === 'storage1') selectedComponents.storage1 = { type: null };
                else if (cat === 'storage2') selectedComponents.storage2 = { type: 'none' };
                else if (cat === 'peripherals' || cat === 'software') selectedComponents[cat] = [];
                else selectedComponents[cat] = null;
            });

            if (preset.platform) {
                selectedPlatform = preset.platform; 
                selectedComponents.platform = preset.platform;
            }
            
            const setComponent = (category, id, quantity = null) => {
                const item = getComponentById(category, id);
                // For Presets, visibility considers the preset's target mode and platform.
                if (item && isComponentVisible(item, preset.mode_target || currentMode, preset.platform) && (item.stock === undefined || item.stock === 999 || item.stock > 0)) { //Undefined stock means available
                    if (category === 'ram' && quantity) {
                        const selectedMb = getComponentById('motherboard', preset.motherboard); 
                        if(selectedMb && item.type === selectedMb.ram_type && quantity <= selectedMb.ram_slots){
                           selectedComponents.ram.type = id;
                           selectedComponents.ram.quantity = quantity;
                        } else if (!selectedMb && quantity <= 4) { 
                            selectedComponents.ram.type = id;
                            selectedComponents.ram.quantity = quantity;
                        }
                    } else if (category === 'storage1') selectedComponents.storage1.type = id;
                    else if (category === 'storage2') selectedComponents.storage2.type = id;
                    else if (category === 'peripherals' && Array.isArray(id)) selectedComponents.peripherals = id.filter(pId => getComponentById('peripherals', pId));
                    else if (category === 'software' && Array.isArray(id)) { 
                        selectedComponents.software = id.filter(sId => getComponentById('software', sId));
                    }
                    else selectedComponents[category] = id;
                    return true;
                }
                return false;
            };
            
            setComponent('casing', preset.casing);
            if (setComponent('motherboard', preset.motherboard)) { 
                setComponent('cpu', preset.cpu); 
                setComponent('ram', preset.ram_type, preset.ram_quantity); 
            } else { 
                 setComponent('cpu', preset.cpu); 
                 setComponent('ram', preset.ram_type, preset.ram_quantity);
            }
            setComponent('storage1', preset.storage1_type);
            setComponent('storage2', preset.storage2_type);
            setComponent('gpu', preset.gpu);
            setComponent('display', preset.display);
            setComponent('keyboard', preset.keyboard);
            
            if(setComponent('os', preset.os)){ // If OS is set
                if(preset.software) setComponent('software', preset.software); // Then attempt to set software
            }

            setComponent('network_adapter', preset.network_adapter);
            setComponent('battery', preset.battery);
            if(preset.peripherals) setComponent('peripherals', preset.peripherals);


            populateOptions(); 
            populateDetailedSoftwareOptions(); 
            updateVisualSelections(); 
            updateTotal();
        }
        
         function updateVisualSelections() {
            document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.checkbox-option-item input[type="checkbox"]').forEach(el => el.checked = false);
            // Specifically reset software checkboxes as they are in a different section
            document.querySelectorAll('#detailed-software-section input[type="checkbox"]').forEach(cb => cb.checked = false);


            if (selectedPlatform) {
                 const platformEl = document.querySelector(`#platform-options .option-item[data-id="${selectedPlatform}"]`);
                 if (platformEl) platformEl.classList.add('selected');
            }

            for (const category in selectedComponents) {
                let selectedIdOrArray = selectedComponents[category];
                if (category === 'ram') selectedIdOrArray = selectedComponents.ram.type;
                else if (category === 'storage1') selectedIdOrArray = selectedComponents.storage1.type;
                else if (category === 'storage2') selectedIdOrArray = selectedComponents.storage2.type;
                
                if (category === 'software') { 
                    selectedIdOrArray.forEach(id => {
                        const el = document.querySelector(`#detailed-software-section input[type="checkbox"][data-id="${id}"]`);
                        if (el) el.checked = true;
                    });
                } else if (category === 'peripherals' && Array.isArray(selectedIdOrArray)) { 
                    selectedIdOrArray.forEach(id => {
                        const el = document.querySelector(`#peripherals-options .checkbox-option-item input[type="checkbox"][data-id="${id}"]`);
                        if (el) el.checked = true;
                    });
                } else if (selectedIdOrArray && typeof selectedIdOrArray === 'string') { // Ensure it's not an object
                    const el = document.querySelector(`#${category}-options .option-item[data-id="${selectedIdOrArray}"]`);
                    if (el) {
                        el.classList.add('selected');
                        const radio = el.querySelector('input[type="radio"]');
                        if(radio) radio.checked = true;
                    }
                }
            }
            document.getElementById('ram-type-select').value = selectedComponents.ram.type || "";
            document.getElementById('ram-quantity-input').value = selectedComponents.ram.quantity;
            
            const noneStorage2El = document.querySelector(`#storage2-options .option-item[data-id="none"]`);
            if (selectedComponents.storage2.type === 'none') {
                if (noneStorage2El) {
                    noneStorage2El.classList.add('selected');
                    const radio = noneStorage2El.querySelector('input[type="radio"]');
                    if (radio) radio.checked = true;
                }
            } else {
                 if (noneStorage2El) {
                    noneStorage2El.classList.remove('selected');
                    const radio = noneStorage2El.querySelector('input[type="radio"]');
                    if (radio) radio.checked = false;
                 }
            }
            
            updateEthernetInfo();
            updateDualBootUI();
        }

        function updateEthernetInfo() {
            const mobo = getComponentById('motherboard', selectedComponents.motherboard);
            const ethernetInfoEl = document.getElementById('ethernet-info');
            if (mobo && mobo.ethernet_speed && mobo.ethernet_speed !== 'N/A') {
                ethernetInfoEl.innerHTML = `${mobo.ethernet_speed} (via placa mãe) `;
                if (mobo.ethernet_speed.includes('10Gbps') || mobo.ethernet_speed.includes('5Gbps')) ethernetInfoEl.innerHTML += ' <i class="fas fa-rocket text-green-500" title="Ultra Rápida!"></i>';
                else if (mobo.ethernet_speed.includes('2.5Gbps')) ethernetInfoEl.innerHTML += ' <i class="fas fa-tachometer-alt text-blue-500" title="Rápida"></i>';
                else ethernetInfoEl.innerHTML += ' <i class="fas fa-network-wired text-gray-500 body.dark-mode:text-gray-400" title="Padrão"></i>';
            } else {
                ethernetInfoEl.textContent = "Verifique a placa mãe ou Indisponível";
            }
        }

        function updateTotal() {
            let componentsTotalPrice = 0;
            for (const category in selectedComponents) {
                if (category === 'platform') continue; // Platform itself has no price contribution here
                if (category === 'ram') {
                    if (selectedComponents.ram.type) {
                        const ramItem = getComponentById('ram', selectedComponents.ram.type);
                        if (ramItem) componentsTotalPrice += ramItem.price * selectedComponents.ram.quantity;
                    }
                } else if (category === 'storage1') componentsTotalPrice += getComponentPrice('storage', selectedComponents.storage1.type);
                else if (category === 'storage2' && selectedComponents.storage2.type !== 'none') componentsTotalPrice += getComponentPrice('storage', selectedComponents.storage2.type);
                else if (category === 'peripherals') selectedComponents.peripherals.forEach(id => componentsTotalPrice += getComponentPrice('peripherals', id));
                else if (category === 'software') {
                    selectedComponents.software.forEach(id => componentsTotalPrice += getComponentPrice('software', id));
                }
                else if (selectedComponents[category] && category !== 'os2' && category !== 'dualboot_disk') {
                    componentsTotalPrice += getComponentPrice(category, selectedComponents[category]);
                }
            }
            if (selectedComponents.os2 && document.getElementById('dualboot-checkbox').checked) {
                componentsTotalPrice += getComponentPrice('os', selectedComponents.os2);
            }

            let finalNotebookPrice = componentsTotalPrice - tradeInCredit;
            document.getElementById('total-price-display').textContent = formatPrice(Math.max(0, finalNotebookPrice));
            
            let servicesTotalPrice = 0;
            selectedServices.forEach(serviceId => {
                servicesTotalPrice += getServicePrice(serviceId);
            });
            document.getElementById('total-services-price-display').textContent = formatPrice(servicesTotalPrice);

            updateSummary();
            calculateTotalPerformance();
        }

        function updateSummary() {
            const summaryDetails = document.getElementById('summary-details');
            summaryDetails.innerHTML = '';
            const getCompName = (cat, id) => getComponentById(cat, id)?.name || 'N/A';
            const getCompIcon = (cat, id) => getComponentById(cat, id)?.icon || 'fas fa-question-circle';

            const addItem = (label, value, iconClass) => {
                if (value && value !== 'N/A') {
                     const iconHtml = iconClass ? `<i class="${iconClass}"></i>` : `<i class="fas fa-ellipsis-h"></i>`;
                     summaryDetails.innerHTML += `<div class="summary-item">${iconHtml}<span class="summary-item-name"><strong>${label}:</strong> ${value}</span></div>`;
                }
            };
            
            if(selectedComponents.platform) addItem('Plataforma', getCompName('platform', selectedComponents.platform), getCompIcon('platform',selectedComponents.platform));
            if(selectedComponents.casing) addItem('Carcaça', getCompName('casing', selectedComponents.casing), getCompIcon('casing',selectedComponents.casing));
            if(selectedComponents.motherboard) addItem('Placa Mãe', getCompName('motherboard', selectedComponents.motherboard), getCompIcon('motherboard',selectedComponents.motherboard));
            if(selectedComponents.cpu) addItem('CPU', getCompName('cpu', selectedComponents.cpu), getCompIcon('cpu',selectedComponents.cpu));
            if (selectedComponents.ram.type) { const ram = getComponentById('ram', selectedComponents.ram.type); if(ram) addItem('RAM', `${selectedComponents.ram.quantity}x ${ram.name}`, ram.icon); }
            if (selectedComponents.storage1.type) addItem('Armazenamento 1', getCompName('storage', selectedComponents.storage1.type), getCompIcon('storage',selectedComponents.storage1.type) || 'fas fa-hdd');
            if (selectedComponents.storage2.type && selectedComponents.storage2.type !== 'none') addItem('Armazenamento 2', getCompName('storage', selectedComponents.storage2.type), getCompIcon('storage',selectedComponents.storage2.type) || 'fas fa-compact-disc');
            else if (selectedComponents.storage2.type === 'none' && selectedComponents.platform) addItem('Armazenamento 2', 'Nenhum', 'fas fa-ban');
            
            if(selectedComponents.gpu) addItem('GPU', getCompName('gpu', selectedComponents.gpu), getCompIcon('gpu',selectedComponents.gpu));
            if(selectedComponents.display) addItem('Tela', getCompName('display', selectedComponents.display), getCompIcon('display',selectedComponents.display));
            if(selectedComponents.keyboard) addItem('Teclado', getCompName('keyboard', selectedComponents.keyboard), getCompIcon('keyboard',selectedComponents.keyboard));
            if(selectedComponents.os) addItem('Sistema Op.', getCompName('os', selectedComponents.os), getCompIcon('os',selectedComponents.os));
            if (document.getElementById('dualboot-checkbox').checked && selectedComponents.os2) {
                addItem('Dual Boot com', getCompName('os', selectedComponents.os2) + (selectedComponents.dualboot_disk === 'additional' ? ' (disco adicional)' : ' (mesmo disco)'), getCompIcon('os', selectedComponents.os2));
            }
            if (selectedComponents.software.length > 0) { 
                addItem('Software Adicional', selectedComponents.software.map(id => getComponentById('software', id)?.name).filter(name => name).join(', ') || 'Nenhum', 'fas fa-cogs');
            }
            if(selectedComponents.network_adapter) addItem('Rede Wi-Fi/BT', getCompName('network_adapter', selectedComponents.network_adapter), getCompIcon('network_adapter',selectedComponents.network_adapter));
            if(selectedComponents.battery) addItem('Bateria', getCompName('battery', selectedComponents.battery), getCompIcon('battery',selectedComponents.battery));
            
            if (selectedComponents.peripherals.length > 0) {
                addItem('Periféricos', selectedComponents.peripherals.map(id => getCompName('peripherals', id)).join(', '), 'fas fa-plus-circle');
            } else if (selectedComponents.platform) { // Only show 'peripherals: none' if a configuration is started
                addItem('Periféricos', 'Nenhum', 'fas fa-ban'); 
            }

            if (tradeInCredit > 0) summaryDetails.innerHTML += `<div class="summary-item"><i class="fas fa-tags text-[var(--color-accent-red)]"></i><span class="summary-item-name text-[var(--color-accent-red)]"><strong>Crédito de Troca:</strong> ${formatPrice(tradeInCredit)}</span></div>`;
        }
        
        function createOptionElement(item, category) { 
            const container = document.createElement('div');
            container.className = 'option-item';
            container.dataset.id = item.id;
            container.dataset.price = item.price;
            container.dataset.category = category;

            const iconHtml = item.icon ? `<i class="${item.icon} section-icon mr-2 text-lg"></i>` : ''; // Removed inline style color
            const descriptionText = getComponentDescription(item, currentMode);
            const stockText = item.stock !== undefined && item.stock !== 999 ? ` (Estoque: ${item.stock})` : (item.stock === 999 ? ' (Disponível)' : '');
            const isOutOfStock = item.stock !== undefined && item.stock <= 0;

            if (isOutOfStock) container.classList.add('disabled');

            let detailsHtml = '';
            if (category === 'os' && item.id !== 'os-none') {
                detailsHtml = `<p class="text-xs text-details mt-1">Armaz.: ${item.storage_impact || 'N/A'} | RAM Mín.: ${item.ram_min || 'N/A'}</p>`;
            } else if (category === 'cpu' && item.npu) {
                detailsHtml = `<p class="text-xs text-details mt-1 text-blue-600 dark:text-blue-400 font-semibold"><i class="fas fa-brain-circuit mr-1"></i> Inclui NPU para IA / Copilot+</p>`;
            }


            container.innerHTML = `
                <div class="option-content w-full">
                    <p class="font-semibold text-name">${iconHtml}${item.name} <span class="text-xs text-gray-500 dark:text-gray-400 font-normal">${stockText}</span></p>
                    <p class="text-sm text-description">${descriptionText}</p>
                    ${detailsHtml}
                    <p class="text-sm price-text mt-auto">${formatPrice(item.price)}</p>
                </div>
            `;
            const input = document.createElement('input'); input.type = 'radio'; input.id = `${category}-${item.id}`; input.name = category; input.value = item.id; input.className = 'hidden';
            container.appendChild(input);

            container.addEventListener('click', () => {
                if (container.classList.contains('disabled')) return;
                currentPresetName = "Personalizado";
                document.getElementById('current-preset-display').textContent = `Preset Ativo: ${currentPresetName}`;

                const prevSelectedPlatform = selectedPlatform;
                const prevSelectedMotherboard = selectedComponents.motherboard;
                const prevSelectedOS = selectedComponents.os;


                if (category === 'platform') {
                    selectedPlatform = item.id;
                    selectedComponents.platform = item.id;
                    if (prevSelectedPlatform && prevSelectedPlatform !== selectedPlatform) {
                        ['motherboard', 'cpu', 'ram', 'storage1', 'storage2', 'gpu', 'network_adapter'].forEach(depCat => { // Broader reset when platform changes
                            if (depCat === 'ram') selectedComponents.ram = {type: null, quantity: 1};
                            else if (depCat === 'storage1') selectedComponents.storage1 = {type: null};
                            else if (depCat === 'storage2') selectedComponents.storage2 = {type: 'none'};
                            else selectedComponents[depCat] = null;
                        });
                    }
                } else if (category === 'storage1') selectedComponents.storage1.type = item.id;
                else if (category === 'storage2') selectedComponents.storage2.type = item.id;
                else selectedComponents[category] = item.id;
                
                if (category === 'os') {
                    if (prevSelectedOS !== item.id) { 
                        selectedComponents.os2 = null; 
                        document.getElementById('dualboot-checkbox').checked = false;
                        selectedComponents.software = []; 
                    }
                    populateDetailedSoftwareOptions(); 
                }


                if (category === 'motherboard' && selectedComponents.motherboard !== prevSelectedMotherboard) {
                    const newMobo = getComponentById('motherboard', selectedComponents.motherboard);
                    if (newMobo) {
                        const currentCpu = getComponentById('cpu', selectedComponents.cpu);
                        if (currentCpu && currentCpu.socket !== newMobo.cpu_socket) selectedComponents.cpu = null;
                        
                        const currentRamType = selectedComponents.ram.type;
                        const currentRamComp = getComponentById('ram', currentRamType);
                        if (currentRamComp && currentRamComp.type !== newMobo.ram_type) {
                            selectedComponents.ram.type = null; 
                        }

                        document.getElementById('ram-max-modules').textContent = newMobo.ram_slots;
                        document.getElementById('ram-quantity-input').max = newMobo.ram_slots;
                        if(selectedComponents.ram.quantity > newMobo.ram_slots) selectedComponents.ram.quantity = newMobo.ram_slots;

                        // Reset storage if motherboard changed, as slot availability might differ
                        selectedComponents.storage1.type = null;
                        selectedComponents.storage2.type = 'none';

                        populateDetailedSoftwareOptions(); // OS compatibility with mobo (e.g. TPM for Win11) might be a factor later
                        
                    } else { 
                        selectedComponents.cpu = null; selectedComponents.ram.type = null;
                        selectedComponents.storage1.type = null; selectedComponents.storage2.type = 'none';
                    }
                }
                if (category === 'cpu') { // If CPU selection forces motherboard change (highly unlikely with current UI flow, but good practice)
                    const newCpu = getComponentById('cpu', selectedComponents.cpu);
                    const currentMobo = getComponentById('motherboard', selectedComponents.motherboard);
                    if (newCpu && currentMobo && newCpu.socket !== currentMobo.cpu_socket) {
                        // This case implies an error in filtering logic upstream if a CPU incompatible with selected mobo was shown/clicked
                        selectedComponents.motherboard = null; 
                        selectedComponents.ram.type = null; 
                        // reset other motherboard-dependent items
                    }
                }
                
                populateOptions(); 
                updateVisualSelections();
                updateTotal();
            });
            return container;
        }
        
        function createCheckboxOptionElement(item, category, isSoftware = false) { 
            const div = document.createElement('div');
            div.className = 'checkbox-option-item';
            // Software (isSoftware=true) is usually not stock-limited, peripherals (isSoftware=false) are.
            if (item.stock !== undefined && item.stock <= 0 && !isSoftware) div.classList.add('disabled');

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `${category}-${item.id}`; // Category here is 'peripherals' or 'software' (not software sub-category)
            checkbox.dataset.id = item.id; 
            checkbox.dataset.price = item.price;
            checkbox.disabled = (item.stock !== undefined && item.stock <= 0 && !isSoftware);

            const label = document.createElement('label');
            label.htmlFor = checkbox.id;
            const iconHtml = item.icon ? `<i class="${item.icon} mr-2"></i>` : ''; // Removed inline style
            label.innerHTML = `${iconHtml}${item.name} <span class="text-xs text-gray-500 dark:text-gray-400">(${formatPrice(item.price)})</span>`;
            
            if (item.description) {
                const descP = document.createElement('p');
                descP.className = 'text-xs text-gray-600 dark:text-gray-400 ml-8 -mt-1'; // Adjusted margin for icon presence
                 descP.style.marginLeft = item.icon ? 'calc(1.25em + 0.75em + 0.5rem)' : '0.75em'; // Dynamic margin on presence of icon
                descP.textContent = item.description;
                label.appendChild(descP);
            }


            div.appendChild(checkbox);
            div.appendChild(label);

            checkbox.addEventListener('change', (e) => {
                currentPresetName = "Personalizado";
                document.getElementById('current-preset-display').textContent = `Preset Ativo: ${currentPresetName}`;
                if (e.target.checked) {
                    if (!selectedComponents[category].includes(item.id)) {
                        selectedComponents[category].push(item.id);
                    }
                } else {
                    selectedComponents[category] = selectedComponents[category].filter(id => id !== item.id);
                }
                updateTotal();
            });
            return div;
        }
        
        function getFilteredOptions(category, currentPlatform, softwareCategoryName = null) { 
            let sourceArray;
            if (category === 'software' && softwareCategoryName) {
                sourceArray = softwareCategories[softwareCategoryName] ? [...softwareCategories[softwareCategoryName]] : [];
            } else {
                sourceArray = components[category] ? [...components[category]] : [];
            }
            
            let filtered = sourceArray.filter(item => isComponentVisible(item, currentMode, currentPlatform));
            
            const selectedMb = getComponentById('motherboard', selectedComponents.motherboard);

            if (category === 'motherboard' && selectedPlatform) { 
                 filtered = filtered.filter(item => item.platform === selectedPlatform);
            } else if (category === 'cpu' && selectedMb) {
                filtered = filtered.filter(item => item.socket === selectedMb.cpu_socket);
            } else if (category === 'ram' && selectedMb) { 
                filtered = filtered.filter(item => item.type === selectedMb.ram_type);
            } else if (category === 'storage') {
                if (selectedMb) {
                    let currentNvmeCount = 0; let currentSataCount = 0;
                    const s1 = getComponentById('storage',selectedComponents.storage1.type);
                    const s2 = getComponentById('storage',selectedComponents.storage2.type);

                    if (s1?.interface === 'NVMe') currentNvmeCount++; 
                    if (s1?.interface === 'SATA') currentSataCount++;
                    if (s2?.interface === 'NVMe') currentNvmeCount++; 
                    if (s2?.interface === 'SATA') currentSataCount++;
                    
                    filtered = filtered.filter(item => {
                        if (item.id === selectedComponents.storage1.type || item.id === selectedComponents.storage2.type) return true;
                        if (selectedMb.nvme_slots === undefined || selectedMb.sata_ports === undefined) return true;
                        if (item.interface === 'NVMe' && currentNvmeCount >= selectedMb.nvme_slots) return false;
                        if (item.interface === 'SATA' && currentSataCount >= selectedMb.sata_ports) return false;
                        if (item.interface === 'NVMe' && item.pcie_gen && selectedMb.pcie_gen) {
                            const itemGenNum = parseInt(item.pcie_gen.replace('Gen',''));
                            const moboGenNum = parseInt(selectedMb.pcie_gen.replace('Gen',''));
                            if (itemGenNum > moboGenNum) return false; 
                        }
                        return true;
                    });
                }
            } else if (category === 'gpu') {
                if (selectedMb?.pcie_gen) { 
                    filtered = filtered.filter(item => {
                        if (item.id === 'integrated' || item.id === 'adreno-copilot') return true; 
                        if (!item.pcie_gen || item.pcie_gen === 'N/A') return true; 
                        return true; 
                    });
                }
            } else if (category === 'software') { // This part is generic to ALL software, should be applied AFTER category selection.
                const mainOS = getComponentById('os', selectedComponents.os);
                if(mainOS && mainOS.id !== 'os-none') {
                    filtered = filtered.filter(sw => sw.os_req && sw.os_req.includes(mainOS.id));
                } else {
                    filtered = []; 
                }
            }
            return filtered;
        }

        function populateOptions() {
            const platformContainer = document.getElementById('platform-options');
            platformContainer.innerHTML = '';
            components.platform.forEach(item => platformContainer.appendChild(createOptionElement(item, 'platform')));
            
            const categoriesToPopulate = ['casing', 'motherboard', 'cpu', 'gpu', 'display', 'keyboard', 'os', 'network_adapter', 'battery'];
            categoriesToPopulate.forEach(category => {
                const container = document.getElementById(`${category}-options`);
                const helperTextEl = document.getElementById(`${category}-helper-text`);
                if (!container) return;
                container.innerHTML = ''; 
                let options;
                if ((category === 'motherboard' && !selectedPlatform) || (category === 'cpu' && !selectedComponents.motherboard)) {
                    if(helperTextEl) helperTextEl.style.display = 'block'; options = [];
                } else {
                   if(helperTextEl) helperTextEl.style.display = 'none';
                   options = getFilteredOptions(category, selectedPlatform);
                }
                 if(options.length === 0 && helperTextEl && category !== 'motherboard' && category !== 'cpu') { // If no options and not the platform/cpu initial state
                    if(container) container.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400">Nenhuma opção compatível disponível no momento. Verifique as seleções anteriores ou o modo (Básico/Avançado).</p>`;
                 } else {
                    options.forEach(item => container.appendChild(createOptionElement(item, category)));
                 }
            });

            const ramTypeSelect = document.getElementById('ram-type-select');
            const ramHelperEl = document.getElementById('ram-type-helper-text');
            const currentRamTypeVal = selectedComponents.ram.type; // Save current value before clearing
            ramTypeSelect.innerHTML = '<option value="">Selecione o Módulo...</option>';
            const selectedMbForRam = getComponentById('motherboard', selectedComponents.motherboard);

            if (selectedMbForRam) {
                ramHelperEl.style.display = 'none'; ramTypeSelect.disabled = false;
                const ramOptions = getFilteredOptions('ram', selectedPlatform); 
                ramOptions.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    const stockInfo = item.stock <=0 ? '(Esgotado!)' : `(Est: ${item.stock})`
                    option.textContent = `${item.name} - ${formatPrice(item.price)} ${stockInfo}`;
                    if (item.stock <= 0) option.disabled = true;
                    ramTypeSelect.appendChild(option);
                });
                // Restore selection if option still exists and is not disabled
                const existingOption = ramTypeSelect.querySelector(`option[value="${currentRamTypeVal}"]`);
                if (existingOption && !existingOption.disabled) {
                    ramTypeSelect.value = currentRamTypeVal;
                } else { // If not, reset selection in state
                    selectedComponents.ram.type = null;
                    ramTypeSelect.value = ""; 
                }
            } else {
                 ramHelperEl.style.display = 'block'; ramTypeSelect.disabled = true; selectedComponents.ram.type = null;
                 ramTypeSelect.value = "";
            }
            const ramQuantityInput = document.getElementById('ram-quantity-input');
            document.getElementById('ram-max-modules').textContent = selectedMbForRam ? selectedMbForRam.ram_slots : 'X';
            ramQuantityInput.max = selectedMbForRam ? selectedMbForRam.ram_slots : 4;
            if (parseInt(ramQuantityInput.value) > parseInt(ramQuantityInput.max)) {
                ramQuantityInput.value = ramQuantityInput.max;
                selectedComponents.ram.quantity = parseInt(ramQuantityInput.max);
            }


            ['storage1', 'storage2'].forEach(storageCat => {
                const sContainer = document.getElementById(`${storageCat}-options`);
                const currentVal = selectedComponents[storageCat]?.type;
                sContainer.innerHTML = '';
                if (storageCat === 'storage2') { 
                     const noneOptData = { id: 'none', name: 'Nenhum', price: 0, description_basic: 'Não adicionar armazenamento secundário.', description_advanced: 'Não adicionar armazenamento secundário. Deixar este slot vazio ou não utilizar uma segunda baia SATA/NVMe.', stock: 999, icon: 'fas fa-ban', interface: 'N/A' }; 
                    const noneOpt = createOptionElement(noneOptData, 'storage2');
                    sContainer.appendChild(noneOpt);
                }
                const sOptions = getFilteredOptions('storage', selectedPlatform); 
                sOptions.forEach(item => { if(item.id !== 'none') sContainer.appendChild(createOptionElement(item, storageCat)); });
                
                const currentOptionElement = sContainer.querySelector(`.option-item[data-id="${currentVal}"]`);
                if (currentOptionElement && !currentOptionElement.classList.contains('disabled')) {
                    // It's valid, selection will be handled by updateVisualSelections
                } else if (storageCat === 'storage2') { // Default to none if current selection is invalid or unavailable
                    selectedComponents.storage2.type = 'none';
                } else { // For storage1, if invalid, it should be null
                     selectedComponents.storage1.type = null; 
                }
            });
            
            const periContainer = document.getElementById('peripherals-options');
            periContainer.innerHTML = '';
            getFilteredOptions('peripherals', selectedPlatform).forEach(item => {
                if (item.id !== 'peri-none') { 
                    const optEl = createCheckboxOptionElement(item, 'peripherals');
                    periContainer.appendChild(optEl);
                }
            });
            
            updateDualBootUI(); 
            // populateDetailedSoftwareOptions is called when OS changes or on initial load
            updateVisualSelections(); // Crucial: Call this after all options are populated to reflect selections
            updateTotal(); 
        }
        
        function populateDetailedSoftwareOptions() {
            const mainSoftwareSection = document.getElementById('detailed-software-section');
            const helperText = document.getElementById('detailed-software-helper-text');
            const selectedOSItem = getComponentById('os', selectedComponents.os);

            if (!selectedOSItem || selectedOSItem.id === 'os-none') {
                mainSoftwareSection.style.display = 'none'; // Hide the entire section
                helperText.textContent = 'Selecione um Sistema Operacional para ver opções de software.';
                helperText.style.display = 'block';
                 if(selectedComponents.software.length > 0) { // If OS was unselected, clear software
                    selectedComponents.software = [];
                    updateTotal(); // And update total price
                }
                return;
            }
            
            mainSoftwareSection.style.display = 'block';
            helperText.style.display = 'none';
            let anySoftwareAvailable = false;

            Object.keys(softwareCategories).forEach(catName => {
                const containerId = `software-${catName}-tab`;
                const container = document.getElementById(containerId);
                if (!container) { console.warn(`Software tab container not found: ${containerId}`); return;}
                container.innerHTML = ''; // Clear previous items

                const softwareItemsForCategory = getFilteredOptions('software', selectedPlatform, catName); // Gets OS-filtered items for THIS category

                if (softwareItemsForCategory.length > 0) {
                    anySoftwareAvailable = true;
                    softwareItemsForCategory.forEach(item => {
                        const optEl = createCheckboxOptionElement(item, 'software', true); 
                         // Check global selectedComponents.software
                        if (selectedComponents.software.includes(item.id)) {
                            optEl.querySelector('input[type="checkbox"]').checked = true;
                        }
                        container.appendChild(optEl);
                    });
                } else {
                    container.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 p-2 col-span-full">Nenhum software nesta categoria compatível com o SO ${selectedOSItem.name} ou disponível no modo atual.</p>`;
                }
            });

            // If no software is available at all for the selected OS, hide the section
            if(!anySoftwareAvailable && mainSoftwareSection.style.display === 'block'){
                 helperText.textContent = `Nenhum software adicional compatível com ${selectedOSItem.name} disponível no momento.`;
                 helperText.style.display = 'block';
                 // Keep mainSoftwareSection display as block, but individual tabs will show messages
            }
             // Ensure the current software tab is active or default to multimedia
            switchSoftwareTab(currentSoftwareTab); 
            updateTotal(); // To reflect any changes due to software (e.g. if previous selections were deselected due to OS change)
        }


        function switchSoftwareTab(tabName) {
            currentSoftwareTab = tabName;
            document.querySelectorAll('.software-tab-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.software-tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `software-${tabName}-tab`);
            });
        }

        function updateDualBootUI() {
            const dualBootSection = document.getElementById('dualboot-section');
            const dualBootCheckbox = document.getElementById('dualboot-checkbox');
            const os2SelectionDiv = document.getElementById('dualboot-os2-selection');
            const os2Select = document.getElementById('os2-select');
            const dualBootDiskSelect = document.getElementById('dualboot-disk-select');
            const additionalDiskOption = document.getElementById('dualboot-additional-disk-option');

            const mainOsSelected = selectedComponents.os && selectedComponents.os !== 'os-none';
            dualBootSection.style.display = mainOsSelected ? 'block' : 'none';

            if (!mainOsSelected) {
                dualBootCheckbox.checked = false; 
                selectedComponents.os2 = null;
            }
            
            os2SelectionDiv.style.display = dualBootCheckbox.checked ? 'block' : 'none';

            if (dualBootCheckbox.checked) {
                const currentOs2Val = selectedComponents.os2;
                os2Select.innerHTML = '<option value="">Selecione o segundo SO...</option>';
                components.os.forEach(os => {
                    if (os.id !== selectedComponents.os && os.id !== 'os-none') { 
                        const option = document.createElement('option');
                        option.value = os.id;
                        option.textContent = `${os.name} (${formatPrice(os.price)}) (Est: ${os.stock})`;
                        if (os.stock <= 0) option.disabled = true;
                        os2Select.appendChild(option);
                    }
                });
                if (currentOs2Val && os2Select.querySelector(`option[value="${currentOs2Val}"]`)) {
                    os2Select.value = currentOs2Val;
                } else {
                    selectedComponents.os2 = null; 
                     os2Select.value = ''; // Ensure placeholder selected if old value is gone
                }

                if (selectedComponents.storage2 && selectedComponents.storage2.type !== 'none' && getComponentById('storage', selectedComponents.storage2.type).stock > 0) {
                    additionalDiskOption.disabled = false;
                } else {
                    additionalDiskOption.disabled = true;
                    if (selectedComponents.dualboot_disk === 'additional') {
                        selectedComponents.dualboot_disk = 'same'; 
                        dualBootDiskSelect.value = 'same';
                    }
                }
            } else {
                selectedComponents.os2 = null; 
                selectedComponents.dualboot_disk = 'same';
            }
        }
        
        function populateServices() {
            const container = document.getElementById('services-options-container');
            container.innerHTML = '';
            services.forEach(service => {
                const serviceEl = document.createElement('div');
                serviceEl.className = 'service-item card p-4'; 
                serviceEl.innerHTML = `
                    <div class="flex items-center mb-2">
                        <input type="checkbox" id="service-${service.id}" data-service-id="${service.id}" class="mr-3 custom-service-checkbox" style="width: 1.25em; height: 1.25em; flex-shrink:0;">
                        <label for="service-${service.id}" class="flex-grow cursor-pointer">
                            <h4 class="text-lg"><i class="${service.icon || 'fas fa-cog'} section-icon mr-2"></i>${service.name}</h4>
                        </label>
                        <span class="price text-lg ml-auto">${service.id === 'serv-iptv-test' ? 'Grátis (Teste)' : formatPrice(service.basePrice)}</span>
                    </div>
                    <p class="text-sm text-gray-600 body.dark-mode:text-gray-400" style="margin-left: calc(1.25em + 0.75rem + 0.5rem);">${service.description}</p>
                    ${service.details ? `
                    <details class="mt-2" style="margin-left: calc(1.25em + 0.75rem + 0.5rem);">
                        <summary class="details-toggle hover:underline text-xs">Mais Detalhes/Tutorial <i class="fas fa-chevron-down text-xs ml-1"></i></summary>
                        <div class="details-content tutorial-details">
                            ${service.details.replace(/\n/g, '<br>')}
                        </div>
                    </details>
                    ` : ''}
                `;
                container.appendChild(serviceEl);
                observer.observe(serviceEl);


                serviceEl.querySelector('input[type="checkbox"]').addEventListener('change', (e) => {
                    const serviceId = e.target.dataset.serviceId;
                    if (e.target.checked) {
                        if (!selectedServices.includes(serviceId)) selectedServices.push(serviceId);
                    } else {
                        selectedServices = selectedServices.filter(id => id !== serviceId);
                    }
                    updateTotal(); 
                });
            });
            updateTotal(); // Initial update of services total
        }

        function toggleAdvancedModeTabs() {
            const aiTab = document.getElementById('tab-ai-integration');
            const budgetTab = document.getElementById('tab-specific-budget');
            if (currentMode === 'advanced') {
                aiTab.style.display = 'inline-block'; 
                budgetTab.style.display = 'inline-block';
            } else {
                aiTab.style.display = 'none';
                budgetTab.style.display = 'none';
                if (activeTab === 'specific-budget') { // If advanced tab was active, switch to configure
                    showTab('configure'); 
                }
            }
        }


        // EVENT LISTENERS
        function setupEventListeners() {
            document.getElementById('quality-slider').addEventListener('input', (event) => {
                const value = parseInt(event.target.value);
                applyQualityPreset(value);
                document.querySelectorAll('#quality-slider-section .flex span').forEach(span => span.classList.remove('quality-label-active'));
                document.getElementById(`quality-label-${value}`).classList.add('quality-label-active');
            });
            
            document.getElementById('ram-quantity-input').addEventListener('input', (event) => {
                let quantity = parseInt(event.target.value);
                const minRam = parseInt(document.getElementById('ram-quantity-input').min) || 1;
                const maxRam = parseInt(document.getElementById('ram-quantity-input').max) || 4; 
                if (isNaN(quantity) || quantity < minRam) quantity = minRam;
                if (quantity > maxRam) quantity = maxRam;
                selectedComponents.ram.quantity = quantity;
                event.target.value = quantity; 
                updateTotal();
                currentPresetName = "Personalizado"; document.getElementById('current-preset-display').textContent = `Preset Ativo: ${currentPresetName}`;
            });

            document.getElementById('ram-type-select').addEventListener('change', (event) => {
                selectedComponents.ram.type = event.target.value || null;
                updateTotal();
                currentPresetName = "Personalizado"; document.getElementById('current-preset-display').textContent = `Preset Ativo: ${currentPresetName}`;
            });


            document.getElementById('basic-mode-btn').addEventListener('click', () => {
                if (currentMode === 'basic') return; currentMode = 'basic';
                document.getElementById('basic-mode-btn').classList.add('active'); document.getElementById('advanced-mode-btn').classList.remove('active');
                toggleAdvancedModeTabs();
                populateOptions(); populateDetailedSoftwareOptions(); updateVisualSelections();
            });

            document.getElementById('advanced-mode-btn').addEventListener('click', () => {
                if (currentMode === 'advanced') return; currentMode = 'advanced';
                document.getElementById('advanced-mode-btn').classList.add('active'); document.getElementById('basic-mode-btn').classList.remove('active');
                toggleAdvancedModeTabs();
                populateOptions(); populateDetailedSoftwareOptions(); updateVisualSelections();
            });

            document.querySelectorAll('.software-tab-button').forEach(button => {
                button.addEventListener('click', () => switchSoftwareTab(button.dataset.tab));
            });

            document.getElementById('dualboot-checkbox').addEventListener('change', (e) => {
                updateDualBootUI();
                updateTotal(); 
            });
            document.getElementById('os2-select').addEventListener('change', (e) => {
                selectedComponents.os2 = e.target.value || null;
                updateTotal();
            });
            document.getElementById('dualboot-disk-select').addEventListener('change', (e) => {
                selectedComponents.dualboot_disk = e.target.value;
            });

            document.getElementById('calculate-tradein').addEventListener('click', () => {
                const conditionEl = document.getElementById('tradein-condition');
                const ageEl = document.getElementById('tradein-age');
                const specsEl = document.getElementById('tradein-specs');

                const condition = conditionEl.value;
                const age = ageEl.value;
                const specs = specsEl.value;
                let baseValue = 0;

                if (specs === 'high-end') baseValue = 900; 
                else if (specs === 'mid-range') baseValue = 450; 
                else baseValue = 150;

                if (age === '<1year') baseValue *= 0.9;
                else if (age === '1-2years') baseValue *= 0.7; 
                else if (age === '2-3years') baseValue *= 0.5; 
                else if (age === '>3years') baseValue *= 0.2;

                if (condition === 'excellent') baseValue *= 1;
                else if (condition === 'good') baseValue *= 0.8; 
                else if (condition === 'fair') baseValue *= 0.5; 
                else if (condition === 'poor') baseValue *= 0.15;

                tradeInCredit = Math.max(0, Math.round(baseValue / 10) * 10); 
                document.getElementById('tradein-value-display').textContent = `Valor Estimado: ${formatPrice(tradeInCredit)}`;
                updateTotal();
            });
            
            document.getElementById('upload-info-btn').addEventListener('click', () => {
                const fileInput = document.getElementById('system-info-file'); const file = fileInput.files[0];
                const resultDisplay = document.getElementById('file-evaluation-result');
                if (!file) { resultDisplay.textContent = "Por favor, selecione um arquivo."; resultDisplay.style.color = 'var(--color-accent-red)'; return; }
                
                resultDisplay.textContent = "Processando relatório..."; resultDisplay.style.color = 'var(--color-primary)';
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result.toLowerCase(); 
                    let fileValue = Math.random() * 100 + 50; 
                    
                    if (content.includes('rtx 4090') || content.includes('rtx 4080ti') || content.includes('i9-14900') || content.includes('i9-13900') || content.includes('ryzen 9 7950') || content.includes('threadripper pro')) fileValue += 1200;
                    else if (content.includes('rtx 4080') || content.includes('rtx 3080ti') || content.includes('rtx 3090') || content.includes('rx 7900xtx') || content.includes('rx 6950xt')) fileValue += 900;
                    else if (content.includes('rtx 4070 ti') || content.includes('rtx 3080') || content.includes('rx 7900 xt') ||  content.includes('rx 6900 xt') || content.includes('i7-14700') || content.includes('i7-13700') || content.includes('ryzen 7 7800x3d')) fileValue += 600;
                    else if (content.includes('rtx 4060 ti') || content.includes('rtx 3070') || content.includes('rx 7800 xt')|| content.includes('rx 6800 xt')) fileValue += 450;
                     else if (content.includes('rtx 4060') || content.includes('rtx 3060ti') || content.includes('rx 7700 xt') || content.includes('rx 6700xt')) fileValue += 300;
                    
                    if (content.includes('64gb') && (content.includes('ddr5'))) fileValue += 350;
                    else if (content.includes('32gb') && (content.includes('ddr5') || content.includes('ddr4'))) fileValue += 200;
                    else if (content.includes('16gb') && (content.includes('ddr5') || content.includes('ddr4'))) fileValue += 100;
                    
                    if (content.includes('nvme') && (content.includes('pcie 5.0') || content.includes('gen5')) && (content.includes('2tb') || content.includes('4tb'))) fileValue += 250;
                    else if (content.includes('nvme') && (content.includes('pcie 4.0') || content.includes('gen4')) && (content.includes('2tb') || content.includes('4tb'))) fileValue += 180;
                    else if (content.includes('nvme') && (content.includes('pcie 4.0') || content.includes('gen4')) && content.includes('1tb')) fileValue += 120;
                    else if (content.includes('nvme') && content.includes('1tb')) fileValue += 80;


                    let estimatedPartsValue = fileValue; 
                    let tradeInOfferFromFile = estimatedPartsValue * 0.50; // Simulate 50% of market value of used parts

                    tradeInCredit = Math.max(tradeInCredit, Math.round(tradeInOfferFromFile / 10) * 10); 
                    document.getElementById('tradein-value-display').textContent = `Valor Estimado (Arquivo): ${formatPrice(tradeInCredit)}`;
                    resultDisplay.textContent = "Relatório processado! Crédito de troca atualizado com base no arquivo (se maior que a estimativa anterior)."; 
                    resultDisplay.style.color = 'var(--color-secondary)';
                    updateTotal();
                };
                reader.onerror = () => { resultDisplay.textContent = "Erro ao ler o arquivo."; resultDisplay.style.color = 'var(--color-accent-red)';};
                reader.readAsText(file);
            });


            const whatsappButtonCart = document.getElementById('whatsapp-order-button');
            const finalizeConfigButtonFooter = document.getElementById('finalize-config-button');
            const orderModal = document.getElementById('order-modal');
            const modalCloseButton = document.getElementById('modal-close-button');
            const mainCloseButton = orderModal.querySelector('.close-button');

            const openConfigOrderModal = () => {
                let allRequiredSelected = true;
                const requiredFields = ['platform', 'casing', 'motherboard', 'cpu', 'ram', 'storage1', 'gpu', 'display', 'keyboard', 'os', 'network_adapter', 'battery'];
                let missingFields = [];
                let modalMessageText = "";

                 if (activeTab !== 'configure'){
                    alert("Por favor, finalize sua configuração na aba 'Configurar Novo' para usar este botão.");
                    return;
                }

                requiredFields.forEach(cat => {
                    const fieldVal = (cat === 'ram') ? selectedComponents.ram.type : (cat === 'storage1' ? selectedComponents.storage1.type : selectedComponents[cat]);
                    if (!fieldVal) { 
                        allRequiredSelected = false; 
                        const fieldTranslations = { platform: "Plataforma", casing: "Carcaça", motherboard: "Placa Mãe", cpu: "CPU", ram: "Tipo de RAM", storage1: "Armazenamento Principal", gpu: "Placa de Vídeo", display: "Tela", keyboard: "Teclado", os: "Sistema Operacional", network_adapter: "Adaptador de Rede", battery: "Bateria"};
                        missingFields.push(fieldTranslations[cat] || cat);
                    }
                });
                
                const modalTitleEl = document.getElementById('modal-title');
                const modalMessageContentEl = document.getElementById('modal-message-content');
                const modalOrderSummaryEl = document.getElementById('modal-order-summary');
                modalOrderSummaryEl.innerHTML = '';

                if (!allRequiredSelected) {
                    modalTitleEl.textContent = "Campos Obrigatórios Faltando";
                    modalMessageText = `<p class="text-[var(--color-accent-red)]"><strong>Atenção:</strong> Para um orçamento preciso de um notebook novo, por favor, selecione todos os componentes obrigatórios: <br><strong>${missingFields.join(', ')}</strong>.</p><p>Você ainda pode gerar uma mensagem para WhatsApp, mas o orçamento pode ser incompleto.</p>`;
                } else {
                    modalTitleEl.textContent = "Revisão do Pedido para WhatsApp";
                    modalMessageText = `<p>Seu pedido de orçamento para notebook está pronto. Verifique os itens abaixo:</p>`;
                }
                modalMessageContentEl.innerHTML = modalMessageText;

                let message = `Olá DeiviTech! Gostaria de solicitar um orçamento para o seguinte notebook personalizado:\n\n*CONFIGURAÇÃO DEIVITECH:*\n`;
                const getCompName = (cat, id) => getComponentById(cat, id)?.name || 'N/A';

                const addMsg = (label, value) => { if (value && value !== 'N/A') message += `* ${label}: ${value}\n`; };
                
                if(selectedComponents.platform) addMsg('Plataforma', getCompName('platform',selectedComponents.platform));
                if(selectedComponents.casing) addMsg('Carcaça', getCompName('casing',selectedComponents.casing));
                if(selectedComponents.motherboard) addMsg('Placa Mãe', getCompName('motherboard',selectedComponents.motherboard));
                if(selectedComponents.cpu) addMsg('CPU', getCompName('cpu',selectedComponents.cpu));
                if (selectedComponents.ram.type) addMsg('RAM', `${selectedComponents.ram.quantity}x ${getCompName('ram',selectedComponents.ram.type)}`);
                if (selectedComponents.storage1.type) addMsg('Armazenamento 1', getCompName('storage',selectedComponents.storage1.type));
                if (selectedComponents.storage2.type && selectedComponents.storage2.type !== 'none') addMsg('Armazenamento 2', getCompName('storage',selectedComponents.storage2.type));
                else if (selectedComponents.storage2.type === 'none' && selectedComponents.platform) addMsg('Armazenamento 2', 'Nenhum'); 
                
                if(selectedComponents.gpu) addMsg('GPU', getCompName('gpu',selectedComponents.gpu));
                if(selectedComponents.display) addMsg('Tela', getCompName('display',selectedComponents.display));
                if(selectedComponents.keyboard) addMsg('Teclado', getCompName('keyboard',selectedComponents.keyboard));
                if(selectedComponents.os) addMsg('Sistema Op.', getCompName('os',selectedComponents.os));
                if (document.getElementById('dualboot-checkbox').checked && selectedComponents.os2) {
                    addMsg('Dual Boot com', getCompName('os', selectedComponents.os2) + (selectedComponents.dualboot_disk === 'additional' ? ' (em disco adicional)' : ' (mesmo disco)'));
                }
                if (selectedComponents.software.length > 0) { 
                    addMsg('Software Adicional', selectedComponents.software.map(id => getComponentById('software', id)?.name).filter(name => name).join(', '));
                }
                if(selectedComponents.network_adapter) addMsg('Rede Wi-Fi/BT', getCompName('network_adapter',selectedComponents.network_adapter));
                if(selectedComponents.battery) addMsg('Bateria', getCompName('battery',selectedComponents.battery));
                if (selectedComponents.peripherals.length > 0) { addMsg('Periféricos', selectedComponents.peripherals.map(id => getCompName('peripherals', id)).join(', ')); }
                else if (selectedComponents.platform) { addMsg('Periféricos', 'Nenhum'); }

                if (tradeInCredit > 0) message += `\n* Crédito de Troca Solicitado/Estimado: ${formatPrice(tradeInCredit)}\n`;
                const totalPrice = parseFloat(document.getElementById('total-price-display').textContent.replace('R$ ', '').replace('.', '').replace(',', '.'));
                message += `\n*ORÇAMENTO TOTAL ESTIMADO DO NOTEBOOK: ${formatPrice(totalPrice)}*\n`;
                
                if (!allRequiredSelected) {
                     message += `\n*AVISO: Alguns componentes obrigatórios não foram selecionados (${missingFields.join(', ')}). Este orçamento pode estar incompleto.*\n`;
                }
                if (currentPresetName !== "Personalizado") {
                    message += `\nPreset Base Utilizado: ${currentPresetName}\n`;
                }
                message += `\nAguardo o contato para confirmação e próximos passos!`;

                modalOrderSummaryEl.innerHTML = message.replace(/\n/g, '<br>').replace(/\*(.*?)\*/g, '<strong>$1</strong>');
                
                let sendToWhatsAppButton = orderModal.querySelector('#send-whatsapp-btn');
                if (sendToWhatsAppButton) sendToWhatsAppButton.remove(); 

                sendToWhatsAppButton = document.createElement('button');
                sendToWhatsAppButton.id = 'send-whatsapp-btn';
                sendToWhatsAppButton.className = 'mt-4 w-full btn btn-primary flex items-center justify-center';
                sendToWhatsAppButton.innerHTML = '<i class="fab fa-whatsapp mr-2"></i> Confirmar e Enviar para WhatsApp';
                
                const modalCloseButtonEl = document.getElementById('modal-close-button');
                modalCloseButtonEl.parentNode.insertBefore(sendToWhatsAppButton, modalCloseButtonEl);
                
                sendToWhatsAppButton.onclick = () => {
                    const whatsappUrl = `https://wa.me/5575981231019?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                    orderModal.style.display = 'none';
                };
                
                document.getElementById('modal-total-price').textContent = document.getElementById('total-price-display').textContent;
                orderModal.style.display = 'flex';
            }

            whatsappButtonCart.addEventListener('click', openConfigOrderModal);
            finalizeConfigButtonFooter.addEventListener('click', openConfigOrderModal);


            mainCloseButton.addEventListener('click', () => { orderModal.style.display = 'none'; });
            modalCloseButton.addEventListener('click', () => { orderModal.style.display = 'none'; });
            window.addEventListener('click', (event) => { if (event.target === orderModal) orderModal.style.display = 'none'; });

            document.getElementById('login-placeholder-btn').addEventListener('click', () => {
                alert("Login (Em Breve):\n\nFuturamente, esta área permitirá que você acesse seu histórico de orçamentos e configurações.\n\nPara trocas de notebooks, o login poderá agilizar o processo de autenticação e avaliação do seu equipamento antigo.\n\nFique de olho nas atualizações!");
            });

            document.getElementById('whatsapp-services-order-button').addEventListener('click', () => {
                let message = "Olá DeiviTech! Gostaria de solicitar um orçamento para os seguintes serviços:\n\n";
                let servicesTotal = 0;
                if (selectedServices.length === 0) {
                    message += "Nenhum serviço selecionado para orçamento no momento.\nSe desejar, pode descrever o serviço que precisa aqui.";
                } else {
                    selectedServices.forEach(serviceId => {
                        const service = getServiceById(serviceId);
                        if (service) {
                            message += `* ${service.name}${service.id === 'serv-iptv-test' ? ' (Teste Grátis)' : ` - ${formatPrice(service.basePrice)}`}\n`;
                            servicesTotal += service.basePrice;
                        }
                    });
                     if (selectedServices.length > 0 && !(selectedServices.length === 1 && selectedServices[0] === 'serv-iptv-test')) { // Dont show total if only IPTV test
                        message += `\n*TOTAL ESTIMADO DOS SERVIÇOS: ${formatPrice(servicesTotal)}*\n`;
                     }
                }
                message += "\nAguardo contato para mais detalhes e agendamento.";
                const whatsappUrl = `https://wa.me/5575981231019?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            });

            document.getElementById('send-specific-budget-request').addEventListener('click', () => {
                const requestText = document.getElementById('specific-budget-request').value;
                if (!requestText.trim()) {
                    alert("Por favor, descreva sua solicitação no campo de texto.");
                    return;
                }
                let message = "Olá DeiviTech! Tenho uma solicitação de orçamento específico:\n\n";
                message += requestText.trim();
                message += "\n\nAguardo contato para discutirmos as possibilidades.";
                const whatsappUrl = `https://wa.me/5575981231019?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            });

            const themeToggleButton = document.getElementById('theme-toggle');
            const body = document.body;
            const themeIcon = themeToggleButton.querySelector('i');
             // Function to get the RGB values for a CSS variable (simplified, assumes hex or direct rgb)
            const getRgbFromCssVar = (cssVarName) => {
                const colorValue = getComputedStyle(body).getPropertyValue(cssVarName).trim();
                if (colorValue.startsWith('#')) { // Hex
                    const r = parseInt(colorValue.substring(1, 3), 16);
                    const g = parseInt(colorValue.substring(3, 5), 16);
                    const b = parseInt(colorValue.substring(5, 7), 16);
                    return `${r}, ${g}, ${b}`;
                } else if (colorValue.startsWith('rgb')) { // rgb(a)
                    return colorValue.match(/\(([^)]+)\)/)[1];
                }
                return '6, 214, 160'; // Default fallback
            };


            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark') {
                body.classList.add('dark-mode');
                themeIcon.classList.remove('fa-lightbulb');
                themeIcon.classList.add('fa-moon');
            } else {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-lightbulb');
            }
            body.style.setProperty('--color-secondaryRgbForAlpha', getRgbFromCssVar('--color-secondary'));


            themeToggleButton.addEventListener('click', () => {
                body.classList.toggle('dark-mode');
                if (body.classList.contains('dark-mode')) {
                    localStorage.setItem('theme', 'dark');
                    themeIcon.classList.remove('fa-lightbulb');
                    themeIcon.classList.add('fa-moon');
                } else {
                    localStorage.setItem('theme', 'light');
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-lightbulb');
                }
                 body.style.setProperty('--color-secondaryRgbForAlpha', getRgbFromCssVar('--color-secondary'));
                 // Force repaint/reflow if necessary for some complex transitions
                 // document.documentElement.style.display = 'none';
                 // document.documentElement.offsetHeight; // Trigger reflow
                 // document.documentElement.style.display = '';
            });
        }

        // INITIALIZATION on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            showTab('configure'); 
            applyQualityPreset(1); 
            document.getElementById('quality-slider').value = "1";
            document.querySelectorAll('#quality-slider-section .flex span').forEach(span => span.classList.remove('quality-label-active'));
            document.getElementById(`quality-label-1`).classList.add('quality-label-active');
            
            populateOptions(); 
            populateDetailedSoftwareOptions(); 
            setupEventListeners();
            updateTotal(); 
            updateVisualSelections(); 
            observeSections(); 
            toggleAdvancedModeTabs(); 
            switchSoftwareTab('multimedia'); // Set initial software sub-tab
        });
    </script>
</body>
</html>
